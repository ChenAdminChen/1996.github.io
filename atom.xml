<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>chen</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://chenadminchen.github.io/"/>
  <updated>2020-02-14T09:25:05.924Z</updated>
  <id>https://chenadminchen.github.io/</id>
  
  <author>
    <name>chen</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>consul-upsync-nginx</title>
    <link href="https://chenadminchen.github.io/2020/02/10/consul-upsync-nginx/"/>
    <id>https://chenadminchen.github.io/2020/02/10/consul-upsync-nginx/</id>
    <published>2020-02-10T14:35:34.000Z</published>
    <updated>2020-02-14T09:25:05.924Z</updated>
    
    <content type="html"><![CDATA[<h2 id="consul-upsync-nginx"><a href="#consul-upsync-nginx" class="headerlink" title="consul-upsync-nginx"></a>consul-upsync-nginx</h2><p>如果 Nginx 遇到大流量和高负载，修改配置文件重启可能并不总是那么方便，因为恢复 Nginx 并重载配置会进一步增加系统负载，并很可能暂时降低性能。而一个个修改配置文件也是很容易出错和费时间的操作。<br>consul+nginx-upsync-module 实现 Nginx 的动态负载。</p><h2 id="consul"><a href="#consul" class="headerlink" title="consul"></a>consul</h2><h3 id="install-consul"><a href="#install-consul" class="headerlink" title="install consul"></a>install consul</h3><p>download: <a href="https://www.consul.io/downloads.html" target="_blank" rel="noopener">https://www.consul.io/downloads.html</a></p><ul><li><p>start consul</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">./consul agent -dev</span></span><br></pre></td></tr></table></figure></li><li><p>stop consul</p></li></ul><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">./consul stop</span></span><br></pre></td></tr></table></figure><ul><li>reload consul</li></ul><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">./consul reload</span></span><br></pre></td></tr></table></figure><ul><li>stop consul<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./consul leave</span><br></pre></td></tr></table></figure></li></ul><h3 id="UI"><a href="#UI" class="headerlink" title="UI"></a>UI</h3><p>ui web address: <a href="http://localhost:8500/" target="_blank" rel="noopener">http://localhost:8500/</a></p><h3 id="http-api-add-service"><a href="#http-api-add-service" class="headerlink" title="http api add service"></a>http api add service</h3><p>curl -X PUT <a href="http://192.168.212.131:8500/v1/catalog/register" target="_blank" rel="noopener">http://192.168.212.131:8500/v1/catalog/register</a></p><p>json body:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"Datacenter"</span>: <span class="string">"dc1"</span>,</span><br><span class="line"> <span class="attr">"Node"</span>:<span class="string">"tomcat"</span>, <span class="attr">"Address"</span>:<span class="string">"192.168.5.165"</span>,</span><br><span class="line"> <span class="attr">"Service"</span>: &#123;</span><br><span class="line">    <span class="attr">"Id"</span> :<span class="string">"192.168.5.165:8080"</span>, </span><br><span class="line">    <span class="attr">"Service"</span>: <span class="string">"itmayiedu"</span>,<span class="attr">"tags"</span>: [<span class="string">"dev"</span>], <span class="attr">"Port"</span>: <span class="number">8080</span></span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>Datacenter指定数据中心，Address指定服务IP，Service.Id指定服务唯一标识，<br>Service.Service指定服务分组，Service.tags指定服务标签（如测试环境、预发环境等）<br>，Service.Port指定服务端口。</p><p>ui web address: <a href="http://localhost:8500/ui/dc1/services" target="_blank" rel="noopener">http://localhost:8500/ui/dc1/services</a></p><h3 id="http-api-add-key-value"><a href="#http-api-add-key-value" class="headerlink" title="http api add key/value"></a>http api add key/value</h3><p>curl -X PUT <a href="http://127.0.0.1:8500/v1/kv/upstreams/tcp/127.0.0.1:6662" target="_blank" rel="noopener">http://127.0.0.1:8500/v1/kv/upstreams/tcp/127.0.0.1:6662</a></p><p>ui web address: <a href="http://localhost:8500/ui/dc1/kv/upstreams" target="_blank" rel="noopener">http://localhost:8500/ui/dc1/kv/upstreams</a></p><h3 id="add-service-configuration-file-in-consul"><a href="#add-service-configuration-file-in-consul" class="headerlink" title="add service configuration file in consul"></a>add service configuration file in consul</h3><p>ref: <a href="https://learn.hashicorp.com/consul/getting-started/services" target="_blank" rel="noopener">https://learn.hashicorp.com/consul/getting-started/services</a></p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">mkdir ./consul.d</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"><span class="built_in">echo</span> <span class="string">'&#123;"service":</span></span></span><br><span class="line">   &#123;"name": "web",</span><br><span class="line">    "tags": ["rails"],</span><br><span class="line">    "port": 80</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;' &gt; ./consul.d/web.json</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">./consul agent -dev -config-dir=./consul.d</span></span><br></pre></td></tr></table></figure><h2 id="nginx-upsync-module"><a href="#nginx-upsync-module" class="headerlink" title="nginx-upsync-module"></a>nginx-upsync-module</h2><ul><li>nginx version</li></ul><p>nginx version is 1.14.0</p><ul><li>nginx-stream-upsync-module version</li></ul><p>nginx-stream-upsync-module version is 1.2.2</p><ul><li>nginx-upsync-modul version</li></ul><p>nginx-upsync-modul version is 2.1.2</p><ul><li>afresh configuration nginx</li></ul><p>from github clone nginx-stream-upsync-module: <a href="https://github.com/xiaokai-wang/nginx-stream-upsync-module/releases" target="_blank" rel="noopener">https://github.com/xiaokai-wang/nginx-stream-upsync-module/releases</a><br>from github clone nginx-upsync-module: <a href="https://github.com/weibocom/nginx-upsync-module/releases" target="_blank" rel="noopener">https://github.com/weibocom/nginx-upsync-module/releases</a>  </p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">nginx-1.14.0&gt; mkdir addons</span><br><span class="line">nginx-1.14.0&gt;mv nginx-stream-upsync-module addnos/</span><br><span class="line">nginx-1.14.0&gt;mv nginx-upsync-module addons/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> --with-stream is not dynamic</span></span><br><span class="line">nginx-1.14.0&gt;./configure --with-cc-opt='-g -O2 -fdebug-prefix-map=/build/nginx-GkiujU/nginx-1.14.0=. -fstack-protector-strong -Wformat -Werror=format-security -fPIC -Wdate-time -D_FORTIFY_SOURCE=2' --with-ld-opt='-Wl,-Bsymbolic-functions -Wl,-z,relro -Wl,-z,now -fPIC' --prefix=/usr/share/nginx --conf-path=/etc/nginx/nginx.conf --http-log-path=/var/log/nginx/access.log --error-log-path=/var/log/nginx/error.log --lock-path=/var/lock/nginx.lock --pid-path=/run/nginx.pid --modules-path=/usr/lib/nginx/modules --http-client-body-temp-path=/var/lib/nginx/body --http-fastcgi-temp-path=/var/lib/nginx/fastcgi --http-proxy-temp-path=/var/lib/nginx/proxy --http-scgi-temp-path=/var/lib/nginx/scgi --http-uwsgi-temp-path=/var/lib/nginx/uwsgi --with-debug --with-pcre-jit --with-http_ssl_module --with-http_stub_status_module --with-http_realip_module --with-http_auth_request_module --with-http_v2_module --with-http_dav_module --with-http_slice_module --with-threads --with-http_addition_module --with-http_geoip_module=dynamic --with-http_gunzip_module --with-http_gzip_static_module --with-http_image_filter_module=dynamic --with-http_sub_module --with-http_xslt_module=dynamic --with-stream_ssl_module --with-mail=dynamic --with-mail_ssl_module --with-stream_realip_module --without-http_rewrite_module --add-module=addons/nginx-upsync-module-2.1.2 --add-module=addons/nginx-stream-upsync-module-1.2.2 --with-stream</span><br></pre></td></tr></table></figure><ul><li><p>make &amp;&amp; make install</p></li><li><p>configuration file</p></li></ul><p>++ http upstream<br>upsteram name is web in consul</p><blockquote><p>nano /etc/nginx/sites-available/default<br><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">upstream backend &#123;</span><br><span class="line">    server 127.0.0.1:3001;</span><br><span class="line">    server 127.0.0.1:3002;</span><br><span class="line">    upsync 127.0.0.1:8500/v1/kv/upstreams/web upsync_timeout=6m upsync_interval=500ms upsync_type=consul strong_dependency=off;</span><br><span class="line"></span><br><span class="line">    upsync_dump_path /usr/local/nginx/conf/servers/servers_test.con;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p></blockquote><p>++ tcp upstream</p><p>upsteram name is tcp in consul</p><blockquote><p>nano /etc/nginx/nginx.conf</p></blockquote><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">user www-data;</span><br><span class="line">worker_processes auto;</span><br><span class="line">pid /run/nginx.pid;</span><br><span class="line">include /etc/nginx/modules-enabled/*.conf;</span><br><span class="line"></span><br><span class="line">stream &#123;</span><br><span class="line">  upstream tcpserver &#123;</span><br><span class="line">    server 127.0.0.1:6661;</span><br><span class="line">    server 127.0.0.1:6662;</span><br><span class="line"></span><br><span class="line">    upsync 127.0.0.1:8500/v1/kv/upstreams/tcp upsync_timeout=6m upsync_interval=500ms upsync_type=consul strong_dependency=off;</span><br><span class="line"></span><br><span class="line">    upsync_dump_path /usr/local/nginx/conf/servers/servers_tcp.con;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  server &#123;</span><br><span class="line">    listen 7777;</span><br><span class="line">    proxy_connect_timeout 10s;</span><br><span class="line">    proxy_timeout 5m;</span><br><span class="line">    proxy_pass tcpserver;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>reload nginx</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;consul-upsync-nginx&quot;&gt;&lt;a href=&quot;#consul-upsync-nginx&quot; class=&quot;headerlink&quot; title=&quot;consul-upsync-nginx&quot;&gt;&lt;/a&gt;consul-upsync-nginx&lt;/h2&gt;&lt;p&gt;如果
      
    
    </summary>
    
    
      <category term="consul" scheme="https://chenadminchen.github.io/tags/consul/"/>
    
      <category term="upsync" scheme="https://chenadminchen.github.io/tags/upsync/"/>
    
      <category term="nginx" scheme="https://chenadminchen.github.io/tags/nginx/"/>
    
  </entry>
  
  <entry>
    <title>nginx</title>
    <link href="https://chenadminchen.github.io/2020/02/10/nginx/"/>
    <id>https://chenadminchen.github.io/2020/02/10/nginx/</id>
    <published>2020-02-10T14:35:34.000Z</published>
    <updated>2020-02-14T07:42:24.440Z</updated>
    
    <content type="html"><![CDATA[<h2 id="nginx"><a href="#nginx" class="headerlink" title="nginx"></a>nginx</h2><p>nginx学习地址: <a href="http://nginx.org/" target="_blank" rel="noopener">http://nginx.org/</a></p><h3 id="install-nginx"><a href="#install-nginx" class="headerlink" title="install nginx"></a>install nginx</h3><h4 id="first-method"><a href="#first-method" class="headerlink" title="first method"></a>first method</h4><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">chen&gt;</span><span class="bash">sudo apt install nginx</span></span><br></pre></td></tr></table></figure><h4 id="second-method"><a href="#second-method" class="headerlink" title="second method"></a>second method</h4><p>download: <a href="http://nginx.org/en/download.html" target="_blank" rel="noopener">http://nginx.org/en/download.html</a></p><p>example: nginx-1.14.0</p><ol><li>configuration module</li></ol><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">nginx-1.14.0&gt;./configure --with-cc-opt='-g -O2 -fdebug-prefix-map=/build/nginx-GkiujU/nginx-1.14.0=. -fstack-protector-strong -Wformat -Werror=format-security -fPIC -Wdate-time -D_FORTIFY_SOURCE=2' --with-ld-opt='-Wl,-Bsymbolic-functions -Wl,-z,relro -Wl,-z,now -fPIC' --prefix=/usr/share/nginx --conf-path=/etc/nginx/nginx.conf --http-log-path=/var/log/nginx/access.log --error-log-path=/var/log/nginx/error.log --lock-path=/var/lock/nginx.lock --pid-path=/run/nginx.pid --modules-path=/usr/lib/nginx/modules --http-client-body-temp-path=/var/lib/nginx/body --http-fastcgi-temp-path=/var/lib/nginx/fastcgi --http-proxy-temp-path=/var/lib/nginx/proxy --http-scgi-temp-path=/var/lib/nginx/scgi --http-uwsgi-temp-path=/var/lib/nginx/uwsgi --with-debug --with-pcre-jit --with-http_ssl_module --with-http_stub_status_module --with-http_realip_module --with-http_auth_request_module --with-http_v2_module --with-http_dav_module --with-http_slice_module --with-threads --with-http_addition_module --with-http_geoip_module=dynamic --with-http_gunzip_module --with-http_gzip_static_module --with-http_image_filter_module=dynamic --with-http_sub_module --with-http_xslt_module=dynamic --with-stream=static --with-stream_ssl_module --with-mail=dynamic --with-mail_ssl_module --with-stream_realip_module --without-http_rewrite_module</span><br></pre></td></tr></table></figure><ol start="2"><li>make</li></ol><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx-1.14.0&gt;make</span><br></pre></td></tr></table></figure><ol start="3"><li>make install</li></ol><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nginx-1.14.0&gt;sudo make install</span><br><span class="line"></span><br><span class="line">nginx-1.14.0&gt; ll  /usr/share/nginx</span><br></pre></td></tr></table></figure><h3 id="nginx-information"><a href="#nginx-information" class="headerlink" title="nginx information"></a>nginx information</h3><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">nginx-1.14.0&gt;./objs/nginx -V</span><br><span class="line"></span><br><span class="line">nginx version: nginx/1.14.0</span><br><span class="line">built by gcc 7.4.0 (Ubuntu 7.4.0-1ubuntu1~18.04.1) </span><br><span class="line">built with OpenSSL 1.1.1  11 Sep 2018</span><br><span class="line">TLS SNI support enabled</span><br><span class="line">configure arguments: --with-cc-opt='-g -O2 -fdebug-prefix-map=/build/nginx-GkiujU/nginx-1.14.0=. -fstack-protector-strong -Wformat -Werror=format-security -fPIC -Wdate-time -D_FORTIFY_SOURCE=2' --with-ld-opt='-Wl,-Bsymbolic-functions -Wl,-z,relro -Wl,-z,now -fPIC' --prefix=/usr/share/nginx --conf-path=/etc/nginx/nginx.conf --http-log-path=/var/log/nginx/access.log --error-log-path=/var/log/nginx/error.log --lock-path=/var/lock/nginx.lock --pid-path=/run/nginx.pid --modules-path=/usr/lib/nginx/modules --http-client-body-temp-path=/var/lib/nginx/body --http-fastcgi-temp-path=/var/lib/nginx/fastcgi --http-proxy-temp-path=/var/lib/nginx/proxy --http-scgi-temp-path=/var/lib/nginx/scgi --http-uwsgi-temp-path=/var/lib/nginx/uwsgi --with-debug --with-pcre-jit --with-http_ssl_module --with-http_stub_status_module --with-http_realip_module --with-http_auth_request_module --with-http_v2_module --with-http_dav_module --with-http_slice_module --with-threads --with-http_addition_module --with-http_geoip_module=dynamic --with-http_gunzip_module --with-http_gzip_static_module --with-http_image_filter_module=dynamic --with-http_sub_module --with-http_xslt_module=dynamic --with-stream=dynamic --with-stream_ssl_module --with-mail=dynamic --with-mail_ssl_module --with-stream_realip_module</span><br></pre></td></tr></table></figure><h3 id="nginx-start-stop-reload"><a href="#nginx-start-stop-reload" class="headerlink" title="nginx start/stop/reload"></a>nginx start/stop/reload</h3><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">nginx-1.14.0&gt;./objs/nginx  #start</span><br><span class="line"></span><br><span class="line">nginx-1.14.0&gt;./objs/nginx -s stop #stop</span><br><span class="line"></span><br><span class="line">nginx-1.14.0&gt;./objs/nginx -s reload #reload</span><br></pre></td></tr></table></figure><h3 id="nginx-http-load-balancing"><a href="#nginx-http-load-balancing" class="headerlink" title="nginx http load-balancing"></a>nginx http load-balancing</h3><p>configuration default.conf<br><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">nginx-1.14.0&gt;cat /etc/nginx/sites-available/default</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">listen 80 default_server;</span><br><span class="line">listen [::]:80 default_server;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">root /var/www/html;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Add index.php to the list <span class="keyword">if</span> you are using PHP</span></span><br><span class="line"><span class="meta">#</span><span class="bash">index index.html index.htm index.nginx-debian.html;</span></span><br><span class="line"></span><br><span class="line">server_name _;</span><br><span class="line"></span><br><span class="line">location / &#123;</span><br><span class="line"><span class="meta">#</span><span class="bash"> First attempt to serve request as file, <span class="keyword">then</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> as directory, <span class="keyword">then</span> fall back to displaying a 404.</span></span><br><span class="line">proxy_pass http://backend;</span><br><span class="line"><span class="meta">#</span><span class="bash">try_files <span class="variable">$uri</span> <span class="variable">$uri</span>/ =404;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">upstream backend &#123;</span><br><span class="line">    server 127.0.0.1:3001;</span><br><span class="line">    server 127.0.0.1:3002;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="nginx-tcp-udp-load-balancing"><a href="#nginx-tcp-udp-load-balancing" class="headerlink" title="nginx tcp/udp load-balancing"></a>nginx tcp/udp load-balancing</h3><p>TCP/UDP load-balancing use stream at nginx 1.9.0 version or last version</p><p>nginx add ngx-stream-core-module, it config –with-stream=dynamic</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">nginx-1.14.0&gt;cat /etc/nginx/nginx.conf</span><br><span class="line"></span><br><span class="line">user www-data;</span><br><span class="line">worker_processes auto;</span><br><span class="line">pid /run/nginx.pid;</span><br><span class="line">include /etc/nginx/modules-enabled/*.conf;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> load ngx_stream_module.so</span></span><br><span class="line">load_module /usr/lib/nginx/modules/ngx_stream_module.so;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">stream &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">  默认的方式: 轮询的方式</span></span><br><span class="line">  upstream tcpserver &#123;</span><br><span class="line">    server 127.0.0.1:6661;</span><br><span class="line">    server 127.0.0.1:6662;</span><br><span class="line">    server 127.0.0.1:6663;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">   least_conn 最少连接数配置,采用一种固定的负载策略,最少连接数策略,也就是选择连接数最少的后台服务</span></span><br><span class="line">  upstream tcpserver_least_conn &#123;</span><br><span class="line">    least_conn;</span><br><span class="line">    server 127.0.0.1:6664;</span><br><span class="line">    server 127.0.0.1:6665;</span><br><span class="line">    server 127.0.0.1:6666;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">   权轮询配置,在轮询策略的基础上给每个后台服务加上权重，权重越大，访问的概率越大</span></span><br><span class="line">  upstream tcpserver_weight &#123;</span><br><span class="line">     server 127.0.0.1:6667 weight=5;</span><br><span class="line">     server 127.0.0.1:6668;</span><br><span class="line">     server 127.0.0.1:6669;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">  最低平均延时配置(商业订阅的一部分提供)</span></span><br><span class="line"><span class="meta">#</span><span class="bash">上面策略配置表示的是对于每个请求，可通过最低平均延时来选择后台服务，而这个最低平均延时则是看 least_time 指令中指定的参数计算出来的，主要有下面三个参数：</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#</span><span class="bash"> connect：连接到后台服务花的时间</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> first_byte：接收到第一个字节花的时间</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> last_byte：接收到最后一个字节花的时间，也就是全部接收完的时间</span></span><br><span class="line"> upstream tcpserver_least_time &#123;</span><br><span class="line">     hash $remote_addr consistent;</span><br><span class="line">     server 127.0.0.1:6670;</span><br><span class="line">     server 127.0.0.1:6671;</span><br><span class="line">     server 127.0.0.1:6672;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">  采用的是 <span class="built_in">hash</span> 算法策略，对客户端的 IP 进行 <span class="built_in">hash</span>，让每台客户端固定访问到后台的一台服务。</span></span><br><span class="line">  upstream tcpserver_hash &#123;</span><br><span class="line">     hash $remote_addr consistent;</span><br><span class="line">     server 127.0.0.1:6673;</span><br><span class="line">     server 127.0.0.1:6674;</span><br><span class="line">     server 127.0.0.1:6675;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">  server &#123;</span><br><span class="line">    listen 7777;</span><br><span class="line">    proxy_connect_timeout 10s;</span><br><span class="line">    proxy_timeout 5m;</span><br><span class="line">    proxy_pass tcpserver;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="nginx-configuration-test"><a href="#nginx-configuration-test" class="headerlink" title="nginx configuration test"></a>nginx configuration test</h3><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nginx-1.14.0&gt;sudo ./objs/nginx -t</span><br><span class="line"></span><br><span class="line">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /etc/nginx/nginx.conf test is successful</span><br></pre></td></tr></table></figure><h3 id="nginx平滑添加模块"><a href="#nginx平滑添加模块" class="headerlink" title="nginx平滑添加模块"></a>nginx平滑添加模块</h3><p>1、先查看nginx版本和已支持的模块<br>2、官网下载相同版本nginx<br>3、添加模块,<a href="nginx http load-balancing">重复 <code>nginx http load-balancing</code></a><br>4、编译成功后make，记住千万不要make install,这样会覆盖你以前的nginx<br>5、备份nginx</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv /usr/local/nginx /usr/local/nginx.bak</span><br></pre></td></tr></table></figure><p>6、复制编译目录下的nginx启动文件</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp ./objs/nginx /usr/local/nginx/sbin/</span><br></pre></td></tr></table></figure><p>7、启动测试<br><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./nginx -</span><br></pre></td></tr></table></figure></p><p>8、重启<br><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./nginx -s reload</span><br></pre></td></tr></table></figure></p><h3 id="nginx-learn-address"><a href="#nginx-learn-address" class="headerlink" title="nginx learn address"></a>nginx learn address</h3><p>ref1: <a href="https://ciphertrick.com/load-balancing-apis-using-nginx-with-example/" target="_blank" rel="noopener">https://ciphertrick.com/load-balancing-apis-using-nginx-with-example/</a><br>ref2: <a href="http://nginx.org/en/docs/stream/stream_processing.html" target="_blank" rel="noopener">http://nginx.org/en/docs/stream/stream_processing.html</a><br>ref3: <a href="http://rookiezhou.top/nginx-%E5%AE%9E%E7%8E%B0-TCP-%E4%BB%A3%E7%90%86%E5%8F%8A%E5%85%B6%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E4%B9%8B-stream-%E6%A8%A1%E5%9D%97/" target="_blank" rel="noopener">http://rookiezhou.top/nginx-%E5%AE%9E%E7%8E%B0-TCP-%E4%BB%A3%E7%90%86%E5%8F%8A%E5%85%B6%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E4%B9%8B-stream-%E6%A8%A1%E5%9D%97/</a><br>ref4: <a href="https://bVlog.csdn.net/slovyz/article/details/53839488" target="_blank" rel="noopener">https://bVlog.csdn.net/slovyz/article/details/53839488</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;nginx&quot;&gt;&lt;a href=&quot;#nginx&quot; class=&quot;headerlink&quot; title=&quot;nginx&quot;&gt;&lt;/a&gt;nginx&lt;/h2&gt;&lt;p&gt;nginx学习地址: &lt;a href=&quot;http://nginx.org/&quot; target=&quot;_blank&quot; rel
      
    
    </summary>
    
    
      <category term="load balancing" scheme="https://chenadminchen.github.io/tags/load-balancing/"/>
    
      <category term="proxy" scheme="https://chenadminchen.github.io/tags/proxy/"/>
    
  </entry>
  
  <entry>
    <title>linux-crontab</title>
    <link href="https://chenadminchen.github.io/2019/12/17/linux-crontab/"/>
    <id>https://chenadminchen.github.io/2019/12/17/linux-crontab/</id>
    <published>2019-12-17T02:35:34.000Z</published>
    <updated>2020-02-10T13:02:20.551Z</updated>
    
    <content type="html"><![CDATA[<h2 id="linux-定时任务"><a href="#linux-定时任务" class="headerlink" title="linux 定时任务"></a>linux 定时任务</h2><h3 id="定时执行的任务"><a href="#定时执行的任务" class="headerlink" title="定时执行的任务"></a>定时执行的任务</h3><blockquote><p>automatic-refund.sh<br><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">获取系统当前时间</span></span><br><span class="line">start=`date -d yesterday +"%Y-%m-%d"`</span><br><span class="line">end=`date -d today +"%Y-%m-%d %H:%M:%S"`</span><br><span class="line">echo $&#123;start&#125; - $&#123;end&#125;</span><br><span class="line"></span><br><span class="line">result=`curl -X POST 'http://localhost:8080/automatic-refund?start='+$&#123;start&#125;+'&amp;end='+$&#123;end&#125; -H 'Content-Type: application/json' -v`</span><br><span class="line"><span class="meta">#</span><span class="bash"> curl -d <span class="string">"start=<span class="variable">$&#123;start&#125;</span>&amp;end=<span class="variable">$&#123;end&#125;</span>"</span> http://localhost:8080/automatic-refund -v</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">输出日志到日志文件</span></span><br><span class="line">echo $&#123;end&#125;:$&#123;result&#125; &gt;&gt; /home/chen/work/autorefund.log</span><br></pre></td></tr></table></figure></p></blockquote><h3 id="设定定时器"><a href="#设定定时器" class="headerlink" title="设定定时器"></a>设定定时器</h3><blockquote><p>crontab -e<br><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Edit this file to introduce tasks to be run by cron.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Each task to run has to be defined through a single line</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> indicating with different fields when the task will be run</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> and what <span class="built_in">command</span> to run <span class="keyword">for</span> the task</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> To define the time you can provide concrete values <span class="keyword">for</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> minute (m), hour (h), day of month (dom), month (mon),</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> and day of week (dow) or use <span class="string">'*'</span> <span class="keyword">in</span> these fields (<span class="keyword">for</span> <span class="string">'any'</span>).<span class="comment"># </span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Notice that tasks will be started based on the cron<span class="string">'s system</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> daemon<span class="string">'s notion of time and timezones.</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Output of the crontab <span class="built_in">jobs</span> (including errors) is sent through</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> email to the user the crontab file belongs to (unless redirected).</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> For example, you can run a backup of all your user accounts</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> at 5 a.m every week with:</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 0 5 * * 1 tar -zcf /var/backups/home.tgz /home/</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> For more information see the manual pages of crontab(5) and cron(8)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> m h  dom mon dow   <span class="built_in">command</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">基本格式 :</span></span><br><span class="line"><span class="meta">#</span><span class="bash">*　　*　　*　　*　　*　　<span class="built_in">command</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">分　时　日　月　周　命令</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">脚本所在的位置 写绝对路径最好</span></span><br><span class="line"><span class="meta">#</span><span class="bash">每天的15点 35分 </span></span><br><span class="line">35 15 * * * bash /home/chen/work/automatic-refund.sh</span><br></pre></td></tr></table></figure></p></blockquote><h3 id="查看定时任务"><a href="#查看定时任务" class="headerlink" title="查看定时任务"></a>查看定时任务</h3><blockquote><p>crontab -l</p></blockquote><h3 id="错误解决"><a href="#错误解决" class="headerlink" title="错误解决"></a>错误解决</h3><p>若定时任务设定好后，没有按设定的执行时，可检查系统时间是否存在不一致的问题</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;linux-定时任务&quot;&gt;&lt;a href=&quot;#linux-定时任务&quot; class=&quot;headerlink&quot; title=&quot;linux 定时任务&quot;&gt;&lt;/a&gt;linux 定时任务&lt;/h2&gt;&lt;h3 id=&quot;定时执行的任务&quot;&gt;&lt;a href=&quot;#定时执行的任务&quot; class
      
    
    </summary>
    
    
      <category term="linux" scheme="https://chenadminchen.github.io/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>mongodb</title>
    <link href="https://chenadminchen.github.io/2019/12/16/install-mongodb/"/>
    <id>https://chenadminchen.github.io/2019/12/16/install-mongodb/</id>
    <published>2019-12-16T09:35:34.000Z</published>
    <updated>2020-02-10T13:02:20.535Z</updated>
    
    <content type="html"><![CDATA[<h2 id="install-mongodb"><a href="#install-mongodb" class="headerlink" title="install mongodb"></a>install mongodb</h2><p><a href="https://docs.mongodb.com/manual/tutorial/install-mongodb-on-red-hat/" target="_blank" rel="noopener">install address</a></p><h3 id="configuration"><a href="#configuration" class="headerlink" title="configuration"></a>configuration</h3><blockquote><p>/etc/mongodb.conf<br><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> mongod.conf</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">for</span> documentation of all options, see:</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   http://docs.mongodb.org/manual/reference/configuration-options/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">where</span> to write logging data.</span></span><br><span class="line">systemLog:</span><br><span class="line">  destination: file</span><br><span class="line">  logAppend: true</span><br><span class="line">  path: /var/log/mongodb/mongod.log</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Where and how to store data.</span></span><br><span class="line">storage:</span><br><span class="line">  dbPath: /var/lib/mongo</span><br><span class="line">  journal:</span><br><span class="line">    enabled: true</span><br><span class="line"><span class="meta">#</span><span class="bash">  engine:</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  wiredTiger:</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> how the process runs</span></span><br><span class="line">processManagement:</span><br><span class="line">  fork: true  # fork and run in background</span><br><span class="line">  pidFilePath: /var/run/mongodb/mongod.pid  # location of pidfile</span><br><span class="line">  timeZoneInfo: /usr/share/zoneinfo</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> network interfaces</span></span><br><span class="line">net:</span><br><span class="line">  port: 27017</span><br><span class="line"><span class="meta">  #</span><span class="bash">bindIp: 127.0.0.1</span></span><br><span class="line">  bindIp: 0.0.0.0  # Enter 0.0.0.0,:: to bind to all IPv4 and IPv6 addresses or, alternatively, use the net.bindIpAll setting.</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">security:</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   authorization: <span class="string">'enabled'</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">operationProfiling:</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">replication:</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">sharding:</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Enterprise-Only Options</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">auditLog:</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">snmp:</span></span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>mongodb install address</p></blockquote><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">whereis mongo</span></span><br></pre></td></tr></table></figure><blockquote><p>start mongodb</p></blockquote><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo service mongod start</span><br><span class="line"></span><br><span class="line">systemctl start mongod.service</span><br></pre></td></tr></table></figure><blockquote><p>stop mongodb</p></blockquote><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo service mongod stop</span><br><span class="line"></span><br><span class="line">systemctl stop mongod.service</span><br></pre></td></tr></table></figure><blockquote><p>mongodb listener</p></blockquote><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -anp |grep 27017</span><br></pre></td></tr></table></figure><h2 id="mongodb-client"><a href="#mongodb-client" class="headerlink" title="mongodb client"></a>mongodb client</h2><p><a href="https://robomongo.org/" target="_blank" rel="noopener">mongodb client download</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;install-mongodb&quot;&gt;&lt;a href=&quot;#install-mongodb&quot; class=&quot;headerlink&quot; title=&quot;install mongodb&quot;&gt;&lt;/a&gt;install mongodb&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://d
      
    
    </summary>
    
    
      <category term="mongodb" scheme="https://chenadminchen.github.io/tags/mongodb/"/>
    
  </entry>
  
  <entry>
    <title>big-data-hbase-hive</title>
    <link href="https://chenadminchen.github.io/2019/11/25/big-data-hbase-hive/"/>
    <id>https://chenadminchen.github.io/2019/11/25/big-data-hbase-hive/</id>
    <published>2019-11-25T07:35:34.000Z</published>
    <updated>2020-02-10T13:02:20.535Z</updated>
    
    <content type="html"><![CDATA[<h2 id="hbase-hive"><a href="#hbase-hive" class="headerlink" title="hbase-hive"></a>hbase-hive</h2><p><a href="https://cwiki.apache.org/confluence/display/Hive/HBaseintegration" target="_blank" rel="noopener">learn address</a></p><h3 id="hbase-table-information"><a href="#hbase-table-information" class="headerlink" title="hbase table information"></a>hbase table information</h3><blockquote><p>describe ‘f’<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Table f is ENABLED                                                                                                                                                                            </span><br><span class="line">f                                                                                                                                                                                             </span><br><span class="line">COLUMN FAMILIES DESCRIPTION                                                                                                                                                                   </span><br><span class="line">&#123;NAME =&gt; 'f', VERSIONS =&gt; '1', EVICT_BLOCKS_ON_CLOSE =&gt; 'false', NEW_VERSION_BEHAVIOR =&gt; 'false', KEEP_DELETED_CELLS =&gt; 'FALSE', CACHE_DATA_ON_WRITE =&gt; 'false', DATA_BLOCK_ENCODING =&gt; 'NONE'</span><br><span class="line">, TTL =&gt; 'FOREVER', MIN_VERSIONS =&gt; '0', REPLICATION_SCOPE =&gt; '0', BLOOMFILTER =&gt; 'ROW', CACHE_INDEX_ON_WRITE =&gt; 'false', IN_MEMORY =&gt; 'false', CACHE_BLOOMS_ON_WRITE =&gt; 'false', PREFETCH_BLO</span><br><span class="line">CKS_ON_OPEN =&gt; 'false', COMPRESSION =&gt; 'NONE', BLOCKCACHE =&gt; 'true', BLOCKSIZE =&gt; '65536'&#125;</span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>scan ‘f’<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ROW                                              COLUMN+CELL                                                                                                                                  </span><br><span class="line"> row1                                            column=f:name, timestamp=1574480231593, value=chen                                                                                           </span><br><span class="line"> row2                                            column=f:age, timestamp=1574660750499, value=11                                                                                              </span><br><span class="line"> row3                                            column=f:name, timestamp=1574666237806, value=kevin</span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>put<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">put &apos;f&apos;,&apos;row6&apos;,&apos;f:age&apos;,34</span><br><span class="line">put &apos;f&apos;,&apos;row6&apos;,&apos;f:name&apos;,&apos;qi&apos;</span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>scan ‘f’</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ROW                                              COLUMN+CELL                                                                                                                                  </span><br><span class="line"> row1                                            column=f:name, timestamp=1574480231593, value=chen                                                                                           </span><br><span class="line"> row2                                            column=f:age, timestamp=1574660750499, value=11                                                                                              </span><br><span class="line"> row3                                            column=f:name, timestamp=1574666237806, value=kevin                                                                                          </span><br><span class="line"> row4                                            column=f:age, timestamp=1574668813422, value=12                                                                                              </span><br><span class="line"> row4                                            column=f:name, timestamp=1574668813422, value=test                                                                                           </span><br><span class="line"> row5                                            column=f:age, timestamp=1574669091951, value=13                                                                                              </span><br><span class="line"> row5                                            column=f:name, timestamp=1574669091951, value=li                                                                                             </span><br><span class="line"> row6                                            column=f:age, timestamp=1574672582983, value=34                                                                                              </span><br><span class="line"> row6                                            column=f:name, timestamp=1574672608454, value=qi</span><br></pre></td></tr></table></figure><h3 id="hive"><a href="#hive" class="headerlink" title="hive"></a>hive</h3><p>hive table information from hbase</p><blockquote><p>create ‘hive_f’<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">EXTERNAL</span> <span class="keyword">TABLE</span> hive_f(<span class="keyword">id</span> <span class="keyword">string</span>, <span class="keyword">value</span> <span class="keyword">string</span>,age <span class="built_in">int</span>) </span><br><span class="line"><span class="keyword">STORED</span> <span class="keyword">BY</span> <span class="string">'org.apache.hadoop.hive.hbase.HBaseStorageHandler'</span></span><br><span class="line"><span class="keyword">WITH</span> SERDEPROPERTIES (<span class="string">"hbase.columns.mapping"</span> = <span class="string">":key,f:name,f:age"</span>)</span><br><span class="line">TBLPROPERTIES(<span class="string">"hbase.table.name"</span> = <span class="string">"f"</span>, <span class="string">"hbase.mapred.output.outputtable"</span> = <span class="string">"f"</span>);</span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>select * from hive_f<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">row1chenNULL</span><br><span class="line">row2NULL11</span><br><span class="line">row3kevinNULL</span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>insert into hive_f(id,value,age) values(‘row4’,’test’,12)</p></blockquote><ul><li>error</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Application Timeout (Remaining Time):Unlimited</span><br><span class="line">Diagnostics:</span><br><span class="line">Application application_1574645197988_0001 failed 2 times due to AM Container for appattempt_1574645197988_0001_000002 exited with exitCode: 1</span><br><span class="line">Failing this attempt.Diagnostics: [2019-11-25 15:33:38.304]Exception from container-launch.</span><br><span class="line">Container id: container_1574645197988_0001_02_000001</span><br><span class="line">Exit code: 1</span><br><span class="line">[2019-11-25 15:33:38.306]Container exited with a non-zero exit code 1. Error file: prelaunch.err.</span><br><span class="line">Last 4096 bytes of prelaunch.err :</span><br><span class="line">Last 4096 bytes of stderr :</span><br><span class="line">错误: 找不到或无法加载主类 org.apache.hadoop.mapreduce.v2.app.MRAppMaster</span><br><span class="line">[2019-11-25 15:33:38.307]Container exited with a non-zero exit code 1. Error file: prelaunch.err.</span><br><span class="line">Last 4096 bytes of prelaunch.err :</span><br><span class="line">Last 4096 bytes of stderr :</span><br><span class="line">错误: 找不到或无法加载主类 org.apache.hadoop.mapreduce.v2.app.MRAppMaster</span><br><span class="line">For more detailed output, check the application tracking page: http://localhost:8088/cluster/app/application_1574645197988_0001 Then click on links to logs of each attempt.</span><br><span class="line">. Failing the application.</span><br></pre></td></tr></table></figure><ul><li>fix (configuration hadoop) </li></ul><p><del>+ get hadoop classpath</del><br><del>./bin/hadoop classpath</del></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/home/chen/work/service/hadoop-3.0.0/etc/hadoop:/home/chen/work/service/hadoop-3.0.0/share/hadoop/</span><br><span class="line">common/lib/*:/home/chen/work/service/hadoop-3.0.0/share/hadoop/common/*:/home/chen/work/service/hadoop-3.0.0</span><br><span class="line">/share/hadoop/hdfs:/home/chen/work/service/hadoop-3.0.0/share/hadoop/hdfs/lib/*:/home/chen/work/service</span><br><span class="line">/hadoop-3.0.0/share/hadoop/hdfs/*:/home/chen/work/service/hadoop-3.0.0/share/hadoop/mapreduce/*:</span><br><span class="line">/home/chen/work/service/hadoop-3.0.0/share/hadoop/yarn:/home/chen/work/service/hadoop-3.0.0/</span><br><span class="line">share/hadoop/yarn/lib/*:/home/chen/work/service/hadoop-3.0.0/share/hadoop/yarn/*</span><br></pre></td></tr></table></figure><ul><li>configuration hadoop mapred-site.xml</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.application.classpath<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>$HADOOP_HOME/share/hadoop/mapreduce/*<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>hbase scan ‘f’</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ROW                                              COLUMN+CELL                                                                                                                                  </span><br><span class="line"> row1                                            column=f:name, timestamp=1574480231593, value=chen                                                                                           </span><br><span class="line"> row2                                            column=f:age, timestamp=1574660750499, value=11                                                                                              </span><br><span class="line"> row3                                            column=f:name, timestamp=1574666237806, value=kevin                                                                                          </span><br><span class="line"> row4                                            column=f:age, timestamp=1574668813422, value=12                                                                                              </span><br><span class="line"> row4                                            column=f:name, timestamp=1574668813422, value=test                                                                                           </span><br><span class="line"> row5                                            column=f:age, timestamp=1574669091951, value=13                                                                                              </span><br><span class="line"> row5                                            column=f:name, timestamp=1574669091951, value=li                                                                                             </span><br><span class="line">5 row(s)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;hbase-hive&quot;&gt;&lt;a href=&quot;#hbase-hive&quot; class=&quot;headerlink&quot; title=&quot;hbase-hive&quot;&gt;&lt;/a&gt;hbase-hive&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://cwiki.apache.org/conf
      
    
    </summary>
    
    
      <category term="big-data" scheme="https://chenadminchen.github.io/tags/big-data/"/>
    
  </entry>
  
  <entry>
    <title>linux</title>
    <link href="https://chenadminchen.github.io/2019/11/22/linux-command-2/"/>
    <id>https://chenadminchen.github.io/2019/11/22/linux-command-2/</id>
    <published>2019-11-22T11:35:34.000Z</published>
    <updated>2020-02-10T13:02:20.551Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Limits-on-Number-of-Files-and-Processes-ulimit"><a href="#Limits-on-Number-of-Files-and-Processes-ulimit" class="headerlink" title="Limits on Number of Files and Processes (ulimit)"></a>Limits on Number of Files and Processes (ulimit)</h3><ol><li>user can open file that size &lt; ??</li></ol><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ulimit -u</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> result : 1024</span></span><br></pre></td></tr></table></figure><ol start="2"><li><p>user can create process(nproc)</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> select all user create process</span></span><br><span class="line">ps h -Led -o user | sort | uniq -c | sort -n</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> select one user create process</span></span><br><span class="line">ps -o nlwp,pid,lwp,args -u chen | sort -n</span><br></pre></td></tr></table></figure></li><li><p>update process number</p></li></ol><p>if command print error, that can change user can process number<br><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Cannot create GC thread. Out of system resources  </span><br><span class="line">java.lang.OutOfMemoryError: unable to create new native thread</span><br></pre></td></tr></table></figure></p><ul><li>需要先看linux操作系统内核版本，通过uname -a查看内核版本，因为2.6版本的内核默认是在/etc/security/limits.d/90-nproc.conf里的配置会覆盖/etc/security/limits.conf的配置</li></ul><blockquote><p>uname -a</p></blockquote><p>Linux hadoop219 2.6.32-431.el6.x86_64 #1 SMP Fri Nov 22 03:15:09 UTC 2013 x86_64 x86_64 x86_64 GNU/Linux</p><ul><li>修改配置文件</li></ul><p>vi /etc/security/limits.d/90-nproc.conf </p><p>注释掉 * soft nproc 1024</p><ul><li>修改limits.conf文件</li></ul><p>vi /etc/security/limits.conf<br>添加 </p><blockquote><p>soft  nproc  655350</p></blockquote><ul><li>在控制台执行(修改这个不需要重启)</li></ul><blockquote><p>ulimit -u 655350</p></blockquote><p>5.检查下是否生效，在控制台切到该用户下</p><blockquote><p>ulimit -u</p></blockquote><h3 id="ssh"><a href="#ssh" class="headerlink" title="ssh"></a>ssh</h3><p><a href="https://code.visualstudio.com/docs/remote/troubleshooting#_configuring-key-based-authentication" target="_blank" rel="noopener">add ssh key learn address</a></p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">db</span></span><br><span class="line">ssh-keygen -t rsa -b 4096</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> generat ssh key</span></span><br><span class="line">ssh-copy-id root@192.168.4.214</span><br></pre></td></tr></table></figure><h3 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h3><h3 id="NTP"><a href="#NTP" class="headerlink" title="NTP"></a>NTP</h3><p>NTP(network time protocol)</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;Limits-on-Number-of-Files-and-Processes-ulimit&quot;&gt;&lt;a href=&quot;#Limits-on-Number-of-Files-and-Processes-ulimit&quot; class=&quot;headerlink&quot; title=&quot;
      
    
    </summary>
    
    
      <category term="linux command" scheme="https://chenadminchen.github.io/tags/linux-command/"/>
    
  </entry>
  
  <entry>
    <title>big-data-environment set-up</title>
    <link href="https://chenadminchen.github.io/2019/11/06/big-data/"/>
    <id>https://chenadminchen.github.io/2019/11/06/big-data/</id>
    <published>2019-11-06T07:35:34.000Z</published>
    <updated>2020-02-10T13:02:20.587Z</updated>
    
    <content type="html"><![CDATA[<h2 id="big-data-environment"><a href="#big-data-environment" class="headerlink" title="big-data environment"></a>big-data environment</h2><ul><li>zookeeper(apache-zookeeper-3.5.6-bin)</li><li>hadoop(hadoop-3.2.1)</li><li>hbase(hbase-2.2.2) </li><li>运行于单机环境中</li><li>安装地址：/home/chen/work/service/</li></ul><h2 id="zookeeper"><a href="#zookeeper" class="headerlink" title="zookeeper"></a>zookeeper</h2><p><a href="http://zookeeper.apache.org/doc/current/zookeeperStarted.html" target="_blank" rel="noopener">zookeeper 学习地址</a></p><h3 id="configuration"><a href="#configuration" class="headerlink" title="configuration"></a>configuration</h3><h4 id="conf-zoo-cfg"><a href="#conf-zoo-cfg" class="headerlink" title="conf/zoo.cfg"></a>conf/zoo.cfg</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">tickTime=2000</span><br><span class="line"># The number of ticks that the initial </span><br><span class="line"># synchronization phase can take</span><br><span class="line">initLimit=10</span><br><span class="line"></span><br><span class="line"># The number of ticks that can pass between </span><br><span class="line"># sending a request and getting an acknowledgement</span><br><span class="line">syncLimit=5</span><br><span class="line"></span><br><span class="line"># the directory where the snapshot is stored.</span><br><span class="line"># do not use /tmp for storage, /tmp here is just </span><br><span class="line"># example sakes.</span><br><span class="line"># dataDir=/tmp/zookeeper</span><br><span class="line">dataDir=/home/chen/work/service/apache-zookeeper-3.5.6-bin/zookeeperdir/zookeeper-data</span><br><span class="line">dataLogDir=/home/chen/work/service/apache-zookeeper-3.5.6-bin/zookeeperdir/logs</span><br><span class="line"></span><br><span class="line"># the port at which the clients will connect</span><br><span class="line">clientPort=2181</span><br><span class="line"></span><br><span class="line"># 集群的配置</span><br><span class="line">server.1=127.0.0.1:2888:3888</span><br></pre></td></tr></table></figure><h3 id="start"><a href="#start" class="headerlink" title="start"></a>start</h3><blockquote><p>./bin/zkServer.sh start</p></blockquote><h3 id="stop"><a href="#stop" class="headerlink" title="stop"></a>stop</h3><blockquote><p>./bin/zkServer.sh stop</p></blockquote><h3 id="client-connection"><a href="#client-connection" class="headerlink" title="client connection"></a>client connection</h3><blockquote><p>./bin/zkCli.sh</p></blockquote><h2 id="hbase-support-hadoop-version"><a href="#hbase-support-hadoop-version" class="headerlink" title="hbase support hadoop version"></a>hbase support hadoop version</h2><p><a href="http://hbase.apache.org/book.html#hadoop" target="_blank" rel="noopener">hbase support hadoop version</a></p><h2 id="hadoop-3-2-1-3-0-0"><a href="#hadoop-3-2-1-3-0-0" class="headerlink" title="hadoop(3.2.1/3.0.0)"></a>hadoop(3.2.1/3.0.0)</h2><p><a href="https://hadoop.apache.org/old/" target="_blank" rel="noopener">hadoop history version</a></p><p><del>hadoop 3.1.x and hadoop 3.2.x not use in hbase</del></p><p><del>This command that can check hadoop</del><br><del>&gt; bin/hdfs getconf -backupNodes</del></p><p><del>hadoop can not use</del><br>~~<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">~~HDFS_GETCONF_USER~~</span><br><span class="line">~~0.0.0.0~~</span><br><span class="line">~~```~~</span><br><span class="line"></span><br><span class="line">~~hadoop can use~~</span><br><span class="line">~~```~~</span><br><span class="line">~~0.0.0.0~~</span><br><span class="line">~~```~~</span><br><span class="line"></span><br><span class="line">### ssh localhost</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### export </span><br><span class="line"></span><br><span class="line">#### sudo nano /etc/profile</span><br><span class="line">```shell script</span><br><span class="line">export HADOOP_HOME=/home/chen/work/service/hadoop-3.2.1</span><br></pre></td></tr></table></figure></p><blockquote><p>source /etc/profile</p></blockquote><h4 id="sudo-nano-barshrc"><a href="#sudo-nano-barshrc" class="headerlink" title="sudo nano ~/.barshrc"></a>sudo nano ~/.barshrc</h4><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export HADOOP_HOME=/home/chen/work/service/hadoop-3.2.1</span><br></pre></td></tr></table></figure><blockquote><p>source ~/.barshrc</p></blockquote><h3 id="etc-hadoop-configuration"><a href="#etc-hadoop-configuration" class="headerlink" title="etc/hadoop configuration"></a>etc/hadoop configuration</h3><h4 id="hadoop-env-sh"><a href="#hadoop-env-sh" class="headerlink" title="hadoop-env.sh"></a>hadoop-env.sh</h4><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="built_in">export</span> HDFS_NAMENODE_USER=<span class="string">"root"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="built_in">export</span> HDFS_DATANODE_USER=<span class="string">"root"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="built_in">export</span> HDFS_SECONDARYNAMENODE_USER=<span class="string">"root"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="built_in">export</span> YARN_RESOURCEMANAGER_USER=<span class="string">"root"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="built_in">export</span> YARN_NODEMANAGER_USER=<span class="string">"root"</span></span></span><br></pre></td></tr></table></figure><h4 id="hdfs-site-xml"><a href="#hdfs-site-xml" class="headerlink" title="hdfs-site.xml"></a>hdfs-site.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.replication<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.name.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>file:///home/chen/work/service/hadoop-3.2.1/hdfs/namenode-test<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.data.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>file:///home/chen/work/service/hadoop-3.2.1/hdfs/datanode-test<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p>./bin/hadoop namenode -format</p><h4 id="core-site-xml"><a href="#core-site-xml" class="headerlink" title="core-site.xml"></a>core-site.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>fs.defaultFS<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://localhost:9000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="mapred-site-xml"><a href="#mapred-site-xml" class="headerlink" title="mapred-site.xml"></a>mapred-site.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapred.job.tracker<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>http://localhost:49001<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapred.local.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>/home/chen/work/service/hadoop-3.2.1/local-dir<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.framework.name<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>yarn<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">     <span class="comment">&lt;!-- &lt;property&gt;</span></span><br><span class="line"><span class="comment">        &lt;name&gt;mapreduce.application.classpath&lt;/name&gt;</span></span><br><span class="line"><span class="comment">        &lt;value&gt;$HADOOP_MAPRED_HOME/share/hadoop/mapreduce/*:$HADOOP_MAPRED_HOME/share/hadoop/mapreduce/lib/*&lt;/value&gt;</span></span><br><span class="line"><span class="comment">    &lt;/property&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="yarn-site-xml"><a href="#yarn-site-xml" class="headerlink" title="yarn-site.xml"></a>yarn-site.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Site specific YARN configuration properties --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.aux-services<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>mapreduce_shuffle<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</span><br><span class="line">    </span><br><span class="line">     <span class="comment">&lt;!-- &lt;property&gt;</span></span><br><span class="line"><span class="comment">        &lt;name&gt;yarn.nodemanager.env-whitelist&lt;/name&gt;</span></span><br><span class="line"><span class="comment">        &lt;value&gt;JAVA_HOME,HADOOP_COMMON_HOME,HADOOP_HDFS_HOME,HADOOP_CONF_DIR,CLASSPATH_PREPEND_DISTCACHE,HADOOP_YARN_HOME,HADOOP_MAPRED_HOME&lt;/value&gt;</span></span><br><span class="line"><span class="comment">    &lt;/property&gt; --&gt;</span></span><br><span class="line">    </span><br><span class="line">            <span class="comment">&lt;!-- 这里设置主节点 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.hostname<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>node01<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">description</span>&gt;</span>The address of the applications manager interface in the RM.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>$&#123;yarn.resourcemanager.hostname&#125;:8032<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">=======</span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 这里设置主节点 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.hostname<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>127.0.0.1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>The address of the applications manager interface in the RM.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>$&#123;yarn.resourcemanager.hostname&#125;:8032<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span> </span><br><span class="line">   </span><br><span class="line">&gt;&gt;&gt;&gt;&gt;&gt;&gt; a592b6d835aac4590431219b3a2377e915609018</span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">description</span>&gt;</span>The address of the scheduler interface.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.scheduler.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>$&#123;yarn.resourcemanager.hostname&#125;:8030<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">description</span>&gt;</span>The https adddress of the RM web application.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.webapp.https.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>$&#123;yarn.resourcemanager.hostname&#125;:8090<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.resource-tracker.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>$&#123;yarn.resourcemanager.hostname&#125;:8031<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">description</span>&gt;</span>The address of the RM admin interface.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.admin.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>$&#123;yarn.resourcemanager.hostname&#125;:8033<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.aux-services<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.webapp.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>$&#123;yarn.resourcemanager.hostname&#125;:8088<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</span><br><span class="line">=======</span><br><span class="line">   <span class="comment">&lt;!-- &lt;property&gt;</span></span><br><span class="line"><span class="comment">        &lt;name&gt;yarn.nodemanager.env-whitelist&lt;/name&gt;</span></span><br><span class="line"><span class="comment">        &lt;value&gt;JAVA_HOME,HADOOP_COMMON_HOME,HADOOP_HDFS_HOME,HADOOP_CONF_DIR,CLASSPATH_PREPEND_DISTCACHE,HADOOP_YARN_HOME,HADOOP_MAPRED_HOME&lt;/value&gt;</span></span><br><span class="line"><span class="comment">    &lt;/property&gt; --&gt;</span></span><br><span class="line">    </span><br><span class="line">            <span class="comment">&lt;!-- 这里设置主节点 --&gt;</span></span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;&gt;&gt;&gt;&gt; a592b6d835aac4590431219b3a2377e915609018</span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="start-1"><a href="#start-1" class="headerlink" title="start"></a>start</h3><p>./sbin/start-all.sh</p><h3 id="web-url"><a href="#web-url" class="headerlink" title="web url"></a>web url</h3><p><a href="http://localhost:8088/cluster" target="_blank" rel="noopener">http://localhost:8088/cluster</a></p><h2 id="hbase-2-2-2"><a href="#hbase-2-2-2" class="headerlink" title="hbase(2.2.2)"></a>hbase(2.2.2)</h2><h3 id="configuration-1"><a href="#configuration-1" class="headerlink" title="configuration"></a>configuration</h3><h4 id="hbase-env-sh"><a href="#hbase-env-sh" class="headerlink" title="hbase-env.sh"></a>hbase-env.sh</h4><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;!-- # HBASE_MANAGES_ZK=false 表示启动的是独立的zookeeper,而配置成true则是hbase自带的zookeeper   --&gt;</span><br><span class="line">export HBASE_MANAGES_ZK=false</span><br><span class="line"></span><br><span class="line">export JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64</span><br></pre></td></tr></table></figure><h4 id="hbase-site-xml"><a href="#hbase-site-xml" class="headerlink" title="hbase-site.xml"></a>hbase-site.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--hdfs://localhost:9000 is hadoop storage data address,you must config address in hadoop core-site.xml    --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.rootdir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://localhost:9000/hbase<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- open web page --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.master.info.port<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>60010<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- distributed = true , hbase use external zookeeper --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.cluster.distributed<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!-- 分布式zookeeper configuration  &lt;value&gt;127.0.0.1,192.168.1.1,192.168.1.2&lt;/value&gt;  --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.zookeeper.quorum<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">value</span>&gt;</span>127.0.0.1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.zookeeper.property.dataDir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>/home/chen/work/service/hbase-2.2.2/hbase-zookeeper<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.zookeeper.property.clientPort<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>2181<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.unsafe.stream.capability.enforce<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span></span><br><span class="line">      Controls whether HBase will check for stream capabilities (hflush/hsync).</span><br><span class="line"></span><br><span class="line">      Disable this if you intend to run on LocalFileSystem, denoted by a rootdir</span><br><span class="line">      with the 'file://' scheme, but be mindful of the NOTE below.</span><br><span class="line"></span><br><span class="line">      WARNING: Setting this to false blinds you to potential data loss and</span><br><span class="line">      inconsistent system state in the event of process and/or node failures. If</span><br><span class="line">      HBase is complaining of an inability to use hsync or hflush it's most</span><br><span class="line">      likely not a false positive.</span><br><span class="line">    <span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="start-2"><a href="#start-2" class="headerlink" title="start"></a>start</h3><blockquote><p>./bin/start-hbase.sh</p></blockquote><h3 id="stop-1"><a href="#stop-1" class="headerlink" title="stop"></a>stop</h3><blockquote><p>./bin/stop-hbase.sh</p></blockquote><h3 id="client-connection-1"><a href="#client-connection-1" class="headerlink" title="client connection"></a>client connection</h3><blockquote><p>./bin/hbase shell</p></blockquote><h3 id="error-fix"><a href="#error-fix" class="headerlink" title="error fix"></a>error fix</h3><h4 id="Could-not-initialize-class-org-apache-hadoop-hbase-io-asyncfs-FanOutOneBlockAsyncDFSOutputHelper"><a href="#Could-not-initialize-class-org-apache-hadoop-hbase-io-asyncfs-FanOutOneBlockAsyncDFSOutputHelper" class="headerlink" title="Could not initialize class org.apache.hadoop.hbase.io.asyncfs.FanOutOneBlockAsyncDFSOutputHelper"></a>Could not initialize class org.apache.hadoop.hbase.io.asyncfs.FanOutOneBlockAsyncDFSOutputHelper</h4><ul><li><p>error</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">2019-01-16 15:26:44,501 ERROR [RS_OPEN_META-regionserver/shizhi002:16020-0] handler.OpenRegionHandler: Failed open of region=hbase:meta,,1.1588230740</span><br><span class="line">java.lang.NoClassDefFoundError: Could not initialize class org.apache.hadoop.hbase.io.asyncfs.FanOutOneBlockAsyncDFSOutputHelper</span><br><span class="line">at org.apache.hadoop.hbase.io.asyncfs.AsyncFSOutputHelper.createOutput(AsyncFSOutputHelper.java:51)</span><br><span class="line">at org.apache.hadoop.hbase.regionserver.wal.AsyncProtobufLogWriter.initOutput(AsyncProtobufLogWriter.java:167)</span><br><span class="line">at org.apache.hadoop.hbase.regionserver.wal.AbstractProtobufLogWriter.init(AbstractProtobufLogWriter.java:166)</span><br><span class="line">at org.apache.hadoop.hbase.wal.AsyncFSWALProvider.createAsyncWriter(AsyncFSWALProvider.java:113)</span><br><span class="line">at org.apache.hadoop.hbase.regionserver.wal.AsyncFSWAL.createWriterInstance(AsyncFSWAL.java:612)</span><br><span class="line">at org.apache.hadoop.hbase.regionserver.wal.AsyncFSWAL.createWriterInstance(AsyncFSWAL.java:124)</span><br><span class="line">at org.apache.hadoop.hbase.regionserver.wal.AbstractFSWAL.rollWriter(AbstractFSWAL.java:756)</span><br><span class="line">at org.apache.hadoop.hbase.regionserver.wal.AbstractFSWAL.rollWriter(AbstractFSWAL.java:486)</span><br><span class="line">at org.apache.hadoop.hbase.regionserver.wal.AsyncFSWAL.&lt;init&gt;(AsyncFSWAL.java:251)</span><br><span class="line">at org.apache.hadoop.hbase.wal.AsyncFSWALProvider.createWAL(AsyncFSWALProvider.java:73)</span><br><span class="line">at org.apache.hadoop.hbase.wal.AsyncFSWALProvider.createWAL(AsyncFSWALProvider.java:48)</span><br><span class="line">at org.apache.hadoop.hbase.wal.AbstractFSWALProvider.getWAL(AbstractFSWALProvider.java:152)</span><br><span class="line">at org.apache.hadoop.hbase.wal.AbstractFSWALProvider.getWAL(AbstractFSWALProvider.java:60)</span><br><span class="line">at org.apache.hadoop.hbase.wal.WALFactory.getWAL(WALFactory.java:284)</span><br><span class="line">at org.apache.hadoop.hbase.regionserver.HRegionServer.getWAL(HRegionServer.java:2104)</span><br><span class="line">at org.apache.hadoop.hbase.regionserver.handler.OpenRegionHandler.openRegion(OpenRegionHandler.java:284)</span><br><span class="line">at org.apache.hadoop.hbase.regionserver.handler.OpenRegionHandler.process(OpenRegionHandler.java:108)</span><br><span class="line">at org.apache.hadoop.hbase.executor.EventHandler.run(EventHandler.java:104)</span><br><span class="line">at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)</span><br><span class="line">at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)</span><br><span class="line">at java.lang.Thread.run(Thread.java:748)</span><br></pre></td></tr></table></figure></li><li><p>fix</p></li></ul><p>WAL(Write-Ahead-Log)是HBase的RegionServer在处理数据插入和删除的过程中用来记录操作内容的一种日志<br>hbase.wal.provider=multiwal，支持的值还有defaultProvider和filesystem<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.wal.provider<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">value</span>&gt;</span>filesystem<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>WAL的持久化的级别有如下几种：</p><p>SKIP_WAL：不写wal日志,这种可以较大提高写入的性能，但是会存在数据丢失的危险，只有在大批量写入的时候才使用(出错了可以重新运行)，其他情况不建议使用。<br>ASYNC_WAL：异步写入<br>SYNC_WAL：同步写入wal日志文件，保证数据写入了DataNode节点。<br>FSYNC_WAL: 目前不支持了，表现是与SYNC_WAL是一致的<br>USE_DEFAULT: 如果没有指定持久化级别，则默认为USE_DEFAULT, 这个为使用HBase全局默认级别(SYNC_WAL)</p><h2 id="start-order"><a href="#start-order" class="headerlink" title="start order"></a>start order</h2><blockquote><p>hadoop -&gt; zookeeper -&gt; hbase<br>zookeeper -&gt; hadoop -&gt; hbase</p></blockquote><h2 id="jps"><a href="#jps" class="headerlink" title="jps"></a>jps</h2><blockquote><p>jps<br><code>`</code>shell script<br>6608 DataNode<br>6817 SecondaryNameNode<br>7939 HRegionServer<br>2019 org.eclipse.equinox.launcher_1.5.600.v20191014-2022.jar<br>7783 HMaster<br>6440 NameNode<br>7576 QuorumPeerMain #使用外部的zookeeper时,启用QuorumPeerMain，否则使用QuorumPeer<br>25401 Main<br>7305 NodeManager<br>7050 ResourceManager<br>8334 Main<br>8814 Jps</p></blockquote><p><code>`</code> </p><h2 id="kafka"><a href="#kafka" class="headerlink" title="kafka"></a>kafka</h2><h2 id="spark"><a href="#spark" class="headerlink" title="spark"></a>spark</h2><h2 id="hive"><a href="#hive" class="headerlink" title="hive"></a>hive</h2><p>###</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;big-data-environment&quot;&gt;&lt;a href=&quot;#big-data-environment&quot; class=&quot;headerlink&quot; title=&quot;big-data environment&quot;&gt;&lt;/a&gt;big-data environment&lt;/h2&gt;&lt;
      
    
    </summary>
    
    
      <category term="big-data" scheme="https://chenadminchen.github.io/tags/big-data/"/>
    
  </entry>
  
  <entry>
    <title>big-data-environment set-up</title>
    <link href="https://chenadminchen.github.io/2019/11/06/big-data-environment/"/>
    <id>https://chenadminchen.github.io/2019/11/06/big-data-environment/</id>
    <published>2019-11-06T07:35:34.000Z</published>
    <updated>2020-02-10T13:02:20.535Z</updated>
    
    <content type="html"><![CDATA[<h2 id="big-data-environment"><a href="#big-data-environment" class="headerlink" title="big-data environment"></a>big-data environment</h2><ul><li>zookeeper(apache-zookeeper-3.5.6-bin)</li><li>hadoop(hadoop-3.2.1)</li><li>hbase(hbase-2.2.2) </li><li>运行于单机环境中</li><li>安装地址：/home/chen/work/service/</li></ul><h2 id="zookeeper"><a href="#zookeeper" class="headerlink" title="zookeeper"></a>zookeeper</h2><p><a href="http://zookeeper.apache.org/doc/current/zookeeperStarted.html" target="_blank" rel="noopener">zookeeper 学习地址</a></p><h3 id="configuration"><a href="#configuration" class="headerlink" title="configuration"></a>configuration</h3><h4 id="conf-zoo-cfg"><a href="#conf-zoo-cfg" class="headerlink" title="conf/zoo.cfg"></a>conf/zoo.cfg</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">tickTime=2000</span><br><span class="line"># The number of ticks that the initial </span><br><span class="line"># synchronization phase can take</span><br><span class="line">initLimit=10</span><br><span class="line"></span><br><span class="line"># The number of ticks that can pass between </span><br><span class="line"># sending a request and getting an acknowledgement</span><br><span class="line">syncLimit=5</span><br><span class="line"></span><br><span class="line"># the directory where the snapshot is stored.</span><br><span class="line"># do not use /tmp for storage, /tmp here is just </span><br><span class="line"># example sakes.</span><br><span class="line"># dataDir=/tmp/zookeeper</span><br><span class="line">dataDir=/home/chen/work/service/apache-zookeeper-3.5.6-bin/zookeeperdir/zookeeper-data</span><br><span class="line">dataLogDir=/home/chen/work/service/apache-zookeeper-3.5.6-bin/zookeeperdir/logs</span><br><span class="line"></span><br><span class="line"># the port at which the clients will connect</span><br><span class="line">clientPort=2181</span><br><span class="line"></span><br><span class="line"># 集群的配置</span><br><span class="line">server.1=127.0.0.1:2888:3888</span><br></pre></td></tr></table></figure><h3 id="start"><a href="#start" class="headerlink" title="start"></a>start</h3><blockquote><p>./bin/zkServer.sh start</p></blockquote><h3 id="stop"><a href="#stop" class="headerlink" title="stop"></a>stop</h3><blockquote><p>./bin/zkServer.sh stop</p></blockquote><h3 id="client-connection"><a href="#client-connection" class="headerlink" title="client connection"></a>client connection</h3><blockquote><p>./bin/zkCli.sh</p></blockquote><h2 id="hbase-support-hadoop-version"><a href="#hbase-support-hadoop-version" class="headerlink" title="hbase support hadoop version"></a>hbase support hadoop version</h2><p><a href="http://hbase.apache.org/book.html#hadoop" target="_blank" rel="noopener">hbase support hadoop version</a></p><h2 id="hadoop-3-2-1-3-0-0"><a href="#hadoop-3-2-1-3-0-0" class="headerlink" title="hadoop(3.2.1/3.0.0)"></a>hadoop(3.2.1/3.0.0)</h2><p><a href="https://hadoop.apache.org/old/" target="_blank" rel="noopener">hadoop history version</a></p><p><del>hadoop 3.1.x and hadoop 3.2.x not use in hbase</del></p><p><del>This command that can check hadoop</del><br><del>&gt; bin/hdfs getconf -backupNodes</del></p><p><del>hadoop can not use</del><br>~~<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">~~HDFS_GETCONF_USER~~</span><br><span class="line">~~0.0.0.0~~</span><br><span class="line">~~```~~</span><br><span class="line"></span><br><span class="line">~~hadoop can use~~</span><br><span class="line">~~```~~</span><br><span class="line">~~0.0.0.0~~</span><br><span class="line">~~```~~</span><br><span class="line"></span><br><span class="line">### ssh localhost</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### export </span><br><span class="line"></span><br><span class="line">#### sudo nano /etc/profile</span><br><span class="line">```shell script</span><br><span class="line">export HADOOP_HOME=/home/chen/work/service/hadoop-3.2.1</span><br></pre></td></tr></table></figure></p><blockquote><p>source /etc/profile</p></blockquote><h4 id="sudo-nano-barshrc"><a href="#sudo-nano-barshrc" class="headerlink" title="sudo nano ~/.barshrc"></a>sudo nano ~/.barshrc</h4><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export HADOOP_HOME=/home/chen/work/service/hadoop-3.2.1</span><br></pre></td></tr></table></figure><blockquote><p>source ~/.barshrc</p></blockquote><h3 id="etc-hadoop-configuration"><a href="#etc-hadoop-configuration" class="headerlink" title="etc/hadoop configuration"></a>etc/hadoop configuration</h3><h4 id="hadoop-env-sh"><a href="#hadoop-env-sh" class="headerlink" title="hadoop-env.sh"></a>hadoop-env.sh</h4><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="built_in">export</span> HDFS_NAMENODE_USER=<span class="string">"root"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="built_in">export</span> HDFS_DATANODE_USER=<span class="string">"root"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="built_in">export</span> HDFS_SECONDARYNAMENODE_USER=<span class="string">"root"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="built_in">export</span> YARN_RESOURCEMANAGER_USER=<span class="string">"root"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="built_in">export</span> YARN_NODEMANAGER_USER=<span class="string">"root"</span></span></span><br></pre></td></tr></table></figure><h4 id="hdfs-site-xml"><a href="#hdfs-site-xml" class="headerlink" title="hdfs-site.xml"></a>hdfs-site.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.replication<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.name.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>file:///home/chen/work/service/hadoop-3.2.1/hdfs/namenode-test<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.data.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>file:///home/chen/work/service/hadoop-3.2.1/hdfs/datanode-test<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">&lt;!--web request hdfs,but not must  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.http.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>0.0.0.0:50070<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p>./bin/hadoop namenode -format</p><h4 id="core-site-xml"><a href="#core-site-xml" class="headerlink" title="core-site.xml"></a>core-site.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>fs.defaultFS<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://localhost:9000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="mapred-site-xml"><a href="#mapred-site-xml" class="headerlink" title="mapred-site.xml"></a>mapred-site.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapred.job.tracker<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>http://localhost:49001<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapred.local.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>/home/chen/work/service/hadoop-3.2.1/local-dir<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.framework.name<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>yarn<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">     <span class="comment">&lt;!-- &lt;property&gt;</span></span><br><span class="line"><span class="comment">        &lt;name&gt;mapreduce.application.classpath&lt;/name&gt;</span></span><br><span class="line"><span class="comment">        &lt;value&gt;$HADOOP_MAPRED_HOME/share/hadoop/mapreduce/*:$HADOOP_MAPRED_HOME/share/hadoop/mapreduce/lib/*&lt;/value&gt;</span></span><br><span class="line"><span class="comment">    &lt;/property&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="yarn-site-xml"><a href="#yarn-site-xml" class="headerlink" title="yarn-site.xml"></a>yarn-site.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Site specific YARN configuration properties --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.aux-services<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>mapreduce_shuffle<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 这里设置主节点 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.hostname<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>127.0.0.1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>The address of the applications manager interface in the RM.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>$&#123;yarn.resourcemanager.hostname&#125;:8032<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span> </span><br><span class="line">   </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">description</span>&gt;</span>The address of the scheduler interface.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.scheduler.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>$&#123;yarn.resourcemanager.hostname&#125;:8030<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">description</span>&gt;</span>The https adddress of the RM web application.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.webapp.https.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>$&#123;yarn.resourcemanager.hostname&#125;:8090<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.resource-tracker.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>$&#123;yarn.resourcemanager.hostname&#125;:8031<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">description</span>&gt;</span>The address of the RM admin interface.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.admin.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>$&#123;yarn.resourcemanager.hostname&#125;:8033<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.aux-services<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.webapp.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>$&#123;yarn.resourcemanager.hostname&#125;:8088<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!-- &lt;property&gt;</span></span><br><span class="line"><span class="comment">        &lt;name&gt;yarn.nodemanager.env-whitelist&lt;/name&gt;</span></span><br><span class="line"><span class="comment">        &lt;value&gt;JAVA_HOME,HADOOP_COMMON_HOME,HADOOP_HDFS_HOME,HADOOP_CONF_DIR,CLASSPATH_PREPEND_DISTCACHE,HADOOP_YARN_HOME,HADOOP_MAPRED_HOME&lt;/value&gt;</span></span><br><span class="line"><span class="comment">    &lt;/property&gt; --&gt;</span></span><br><span class="line">    </span><br><span class="line">            <span class="comment">&lt;!-- 这里设置主节点 --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="start-1"><a href="#start-1" class="headerlink" title="start"></a>start</h3><p>./sbin/start-all.sh</p><h3 id="web-url"><a href="#web-url" class="headerlink" title="web url"></a>web url</h3><p><a href="http://localhost:8088/cluster" target="_blank" rel="noopener">http://localhost:8088/cluster</a></p><h2 id="hbase-2-2-2"><a href="#hbase-2-2-2" class="headerlink" title="hbase(2.2.2)"></a>hbase(2.2.2)</h2><h3 id="configuration-1"><a href="#configuration-1" class="headerlink" title="configuration"></a>configuration</h3><h4 id="hbase-env-sh"><a href="#hbase-env-sh" class="headerlink" title="hbase-env.sh"></a>hbase-env.sh</h4><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;!-- # HBASE_MANAGES_ZK=false 表示启动的是独立的zookeeper,而配置成true则是hbase自带的zookeeper   --&gt;</span><br><span class="line">export HBASE_MANAGES_ZK=false</span><br><span class="line"></span><br><span class="line">export JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64</span><br></pre></td></tr></table></figure><h4 id="hbase-site-xml"><a href="#hbase-site-xml" class="headerlink" title="hbase-site.xml"></a>hbase-site.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--hdfs://localhost:9000 is hadoop storage data address,you must config address in hadoop core-site.xml    --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.rootdir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://localhost:9000/hbase<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- open web page --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.master.info.port<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>60010<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- distributed = true , hbase use external zookeeper --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.cluster.distributed<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!-- 分布式zookeeper configuration  &lt;value&gt;127.0.0.1,192.168.1.1,192.168.1.2&lt;/value&gt;  --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.zookeeper.quorum<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">value</span>&gt;</span>127.0.0.1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.zookeeper.property.dataDir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>/home/chen/work/service/hbase-2.2.2/hbase-zookeeper<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.zookeeper.property.clientPort<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>2181<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.unsafe.stream.capability.enforce<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span></span><br><span class="line">      Controls whether HBase will check for stream capabilities (hflush/hsync).</span><br><span class="line"></span><br><span class="line">      Disable this if you intend to run on LocalFileSystem, denoted by a rootdir</span><br><span class="line">      with the 'file://' scheme, but be mindful of the NOTE below.</span><br><span class="line"></span><br><span class="line">      WARNING: Setting this to false blinds you to potential data loss and</span><br><span class="line">      inconsistent system state in the event of process and/or node failures. If</span><br><span class="line">      HBase is complaining of an inability to use hsync or hflush it's most</span><br><span class="line">      likely not a false positive.</span><br><span class="line">    <span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="start-2"><a href="#start-2" class="headerlink" title="start"></a>start</h3><blockquote><p>./bin/start-hbase.sh</p></blockquote><h3 id="stop-1"><a href="#stop-1" class="headerlink" title="stop"></a>stop</h3><blockquote><p>./bin/stop-hbase.sh</p></blockquote><h3 id="client-connection-1"><a href="#client-connection-1" class="headerlink" title="client connection"></a>client connection</h3><blockquote><p>./bin/hbase shell</p></blockquote><h3 id="error-fix"><a href="#error-fix" class="headerlink" title="error fix"></a>error fix</h3><h4 id="Could-not-initialize-class-org-apache-hadoop-hbase-io-asyncfs-FanOutOneBlockAsyncDFSOutputHelper"><a href="#Could-not-initialize-class-org-apache-hadoop-hbase-io-asyncfs-FanOutOneBlockAsyncDFSOutputHelper" class="headerlink" title="Could not initialize class org.apache.hadoop.hbase.io.asyncfs.FanOutOneBlockAsyncDFSOutputHelper"></a>Could not initialize class org.apache.hadoop.hbase.io.asyncfs.FanOutOneBlockAsyncDFSOutputHelper</h4><ul><li><p>error</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">2019-01-16 15:26:44,501 ERROR [RS_OPEN_META-regionserver/shizhi002:16020-0] handler.OpenRegionHandler: Failed open of region=hbase:meta,,1.1588230740</span><br><span class="line">java.lang.NoClassDefFoundError: Could not initialize class org.apache.hadoop.hbase.io.asyncfs.FanOutOneBlockAsyncDFSOutputHelper</span><br><span class="line">at org.apache.hadoop.hbase.io.asyncfs.AsyncFSOutputHelper.createOutput(AsyncFSOutputHelper.java:51)</span><br><span class="line">at org.apache.hadoop.hbase.regionserver.wal.AsyncProtobufLogWriter.initOutput(AsyncProtobufLogWriter.java:167)</span><br><span class="line">at org.apache.hadoop.hbase.regionserver.wal.AbstractProtobufLogWriter.init(AbstractProtobufLogWriter.java:166)</span><br><span class="line">at org.apache.hadoop.hbase.wal.AsyncFSWALProvider.createAsyncWriter(AsyncFSWALProvider.java:113)</span><br><span class="line">at org.apache.hadoop.hbase.regionserver.wal.AsyncFSWAL.createWriterInstance(AsyncFSWAL.java:612)</span><br><span class="line">at org.apache.hadoop.hbase.regionserver.wal.AsyncFSWAL.createWriterInstance(AsyncFSWAL.java:124)</span><br><span class="line">at org.apache.hadoop.hbase.regionserver.wal.AbstractFSWAL.rollWriter(AbstractFSWAL.java:756)</span><br><span class="line">at org.apache.hadoop.hbase.regionserver.wal.AbstractFSWAL.rollWriter(AbstractFSWAL.java:486)</span><br><span class="line">at org.apache.hadoop.hbase.regionserver.wal.AsyncFSWAL.&lt;init&gt;(AsyncFSWAL.java:251)</span><br><span class="line">at org.apache.hadoop.hbase.wal.AsyncFSWALProvider.createWAL(AsyncFSWALProvider.java:73)</span><br><span class="line">at org.apache.hadoop.hbase.wal.AsyncFSWALProvider.createWAL(AsyncFSWALProvider.java:48)</span><br><span class="line">at org.apache.hadoop.hbase.wal.AbstractFSWALProvider.getWAL(AbstractFSWALProvider.java:152)</span><br><span class="line">at org.apache.hadoop.hbase.wal.AbstractFSWALProvider.getWAL(AbstractFSWALProvider.java:60)</span><br><span class="line">at org.apache.hadoop.hbase.wal.WALFactory.getWAL(WALFactory.java:284)</span><br><span class="line">at org.apache.hadoop.hbase.regionserver.HRegionServer.getWAL(HRegionServer.java:2104)</span><br><span class="line">at org.apache.hadoop.hbase.regionserver.handler.OpenRegionHandler.openRegion(OpenRegionHandler.java:284)</span><br><span class="line">at org.apache.hadoop.hbase.regionserver.handler.OpenRegionHandler.process(OpenRegionHandler.java:108)</span><br><span class="line">at org.apache.hadoop.hbase.executor.EventHandler.run(EventHandler.java:104)</span><br><span class="line">at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)</span><br><span class="line">at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)</span><br><span class="line">at java.lang.Thread.run(Thread.java:748)</span><br></pre></td></tr></table></figure></li><li><p>fix</p></li></ul><p>WAL(Write-Ahead-Log)是HBase的RegionServer在处理数据插入和删除的过程中用来记录操作内容的一种日志<br>hbase.wal.provider=multiwal，支持的值还有defaultProvider和filesystem<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.wal.provider<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">value</span>&gt;</span>filesystem<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>WAL的持久化的级别有如下几种：</p><p>SKIP_WAL：不写wal日志,这种可以较大提高写入的性能，但是会存在数据丢失的危险，只有在大批量写入的时候才使用(出错了可以重新运行)，其他情况不建议使用。<br>ASYNC_WAL：异步写入<br>SYNC_WAL：同步写入wal日志文件，保证数据写入了DataNode节点。<br>FSYNC_WAL: 目前不支持了，表现是与SYNC_WAL是一致的<br>USE_DEFAULT: 如果没有指定持久化级别，则默认为USE_DEFAULT, 这个为使用HBase全局默认级别(SYNC_WAL)</p><h2 id="start-order"><a href="#start-order" class="headerlink" title="start order"></a>start order</h2><blockquote><p>hadoop -&gt; zookeeper -&gt; hbase<br>zookeeper -&gt; hadoop -&gt; hbase</p></blockquote><h2 id="jps"><a href="#jps" class="headerlink" title="jps"></a>jps</h2><blockquote><p>jps<br><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">6608 DataNode</span><br><span class="line">6817 SecondaryNameNode</span><br><span class="line">7939 HRegionServer</span><br><span class="line">2019 org.eclipse.equinox.launcher_1.5.600.v20191014-2022.jar</span><br><span class="line">7783 HMaster</span><br><span class="line">6440 NameNode</span><br><span class="line">7576 QuorumPeerMain #使用外部的zookeeper时,启用QuorumPeerMain，否则使用QuorumPeer</span><br><span class="line">25401 Main</span><br><span class="line">7305 NodeManager</span><br><span class="line">7050 ResourceManager</span><br><span class="line">8334 Main</span><br><span class="line">8814 Jps</span><br><span class="line"></span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">test环境redis信息：</span><br><span class="line">redis-cli -h 121.40.83.65 auth Yftestredis123</span><br><span class="line"></span><br><span class="line">redis-cli -h 121.40.83.65 -p 6379 -a Yftestredis123</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># kafka</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># spark</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># hive</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># configuration </span></span></span><br><span class="line"></span><br><span class="line">hive-env.sh</span><br><span class="line"></span><br><span class="line">```shell script</span><br><span class="line">HADOOP_HOME=/home/chen/work/service/hadoop-3.0.0</span><br><span class="line">HBASE_HOME=/home/chen/work/service/hbase-2.2.2</span><br><span class="line"></span><br><span class="line">JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64</span><br><span class="line"></span><br><span class="line">HIVE_HOME=/home/chen/work/service/apache-hive-3.1.2-bin</span><br><span class="line"></span><br><span class="line">export HIVE_CONF_DIR=$HIVE_HOME/conf</span><br><span class="line">export HIVE_AUX_JARS_PATH=$HBASE_HOME/lib</span><br><span class="line">export CLASSPATH=$CLASSPATH:$JAVA_HOME/lib:$HADOOP_HOME/lib:$HIVE_HOME/lib</span><br></pre></td></tr></table></figure></p></blockquote><p>hive-site.xml<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionURL<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>jdbc:mysql://localhost:3306/hivedbH?createDatabaseIfNotExist=true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>JDBC connect string for a JDBC metastore<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 如果 mysql 和 hive 在同一个服务器节点，那么请更改 hadoop02 为 localhost --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionDriverName<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>Driver class name for a JDBC metastore<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionUserName<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>root<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>username to use against metastore database<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionPassword<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>as1996<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>password to use against metastore database<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>datanucleus.autoCreateSchema<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>datanucleus.autoCreateTables<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>datanucleus.autoCreateColumns<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- 设置 hive仓库的HDFS上的位置 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.metastore.warehouse.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>/home/chen/work/service/apache-hive-3.1.2-bin/hive/data<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>location of default database for the warehouse<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.downloaded.resources.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>/home/chen/work/service/apache-hive-3.1.2-bin/hive/resources<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>Temporary local directory for added resources in the remote file system.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- 修改日志位置 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.exec.local.scratchdir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>/home/chen/work/service/apache-hive-3.1.2-bin/hive/HiveJobsLog<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>Local scratch space for Hive jobs<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.downloaded.resources.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>/home/chen/work/service/apache-hive-3.1.2-bin/hive/ResourcesLog<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>Temporary local directory for added resources in the remote file system.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.querylog.location<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>/home/chen/work/service/apache-hive-3.1.2-bin/hive/HiveRunLog<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>Location of Hive run time structured log file<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.server2.logging.operation.log.location<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>/home/chen/work/service/apache-hive-3.1.2-bin/hive/OpertitionLog<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>Top level directory where operation tmp are stored if logging functionality is enabled<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- 配置HWI接口 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.hwi.war.file<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>/home/chen/work/service/apache-hive-3.1.2-bin/lib/hive-hwi-2.1.1.jar<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>This sets the path to the HWI war file, relative to $&#123;HIVE_HOME&#125;. <span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.hwi.listen.host<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>localhost<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>This is the host address the Hive Web Interface will listen on<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.hwi.listen.port<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>9999<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>This is the port the Hive Web Interface will listen on<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.server2.thrift.bind.host<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>localhost<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.server2.thrift.port<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>10000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.server2.thrift.http.port<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>10001<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.server2.thrift.http.path<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>cliservice<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- HiveServer2的WEB UI --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.server2.webui.host<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>localhost<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.server2.webui.port<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>10002<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.scratch.dir.permission<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>755<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.server2.enable.doAs<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.auto.convert.join<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>spark.dynamicAllocation.enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>动态分配资源<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.execution.engine<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>spark<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>这个值可以使mr/tez/spark中的一个作为hive的执行引擎，mr是默认值，而tez仅hadoop 2支持<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.enable.spark.execution.engine<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>spark.home<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>/home/chen/work/service/spark-2.3.0-bin-hadoop2.7<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>spark.master<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>spark://127.0.0.1:7077<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &lt;value&gt;yarn-client&lt;/value&gt; --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>spark.serializer<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>org.apache.spark.serializer.KryoSerializer<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>spark.executor.memeory<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>1g<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>spark.driver.memeory<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>1g<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- &lt;property&gt;</span></span><br><span class="line"><span class="comment">  &lt;name&gt;spark.executor.extraJavaOptions&lt;/name&gt;</span></span><br><span class="line"><span class="comment">  &lt;value&gt;-XX:+PrintGCDetails -Dkey=value -Dnumbers="one two three"&lt;/value&gt;</span></span><br><span class="line"><span class="comment">&lt;/property&gt; --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 使用Hive on spark时,若不设置下列该配置会出现内存溢出异常 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>spark.driver.extraJavaOptions<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>-XX:PermSize=128M -XX:MaxPermSize=512M<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>spark.submit.deployMode<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>client<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>spark.eventLog.enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>spark.eventLog.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://localhost:9000/spark-log<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.exec.reducers.bytes.per.reducer<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>1024<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.job.reduces<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>10<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span> hive.exec.reducers.bytes.per.reducer<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>10<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>spark.yarn.jars<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://localhost:8020/spark-jars/*<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></p><blockquote><p> 拷贝JDBC包<br><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp mysql-connector-java-5.1.19-bin.jar /hive-2.1.1/lib/</span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>删除Hadoop之前的jline包，拷贝Hive中jline的扩展包<br><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /hive-2.1.1/lib/jline-2.12.jar /hadoop-3.0.0/share/hadoop/yarn/lib/</span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>拷贝tools.jar包<br><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /java8/lib/tools.jar /hive-2.1.1/lib/</span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>init matedata database<br><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">./bin/schematool -dbType mysql -initSchema</span><br></pre></td></tr></table></figure></p></blockquote><h2 id="start-hive"><a href="#start-hive" class="headerlink" title="start hive"></a>start hive</h2><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/hive</span><br></pre></td></tr></table></figure><h3 id="start-serverhive2"><a href="#start-serverhive2" class="headerlink" title="start serverhive2"></a>start serverhive2</h3><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./bin/hiveserver2</span><br><span class="line"></span><br><span class="line">./bin/hiveserver2 --hiveconf hive.root.logger=INFO,console</span><br></pre></td></tr></table></figure><h3 id="jdbc-connect-hive"><a href="#jdbc-connect-hive" class="headerlink" title="jdbc connect hive"></a>jdbc connect hive</h3><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/beeline -u jdbc:hive2://localhost:10000/default</span><br></pre></td></tr></table></figure><h3 id="error"><a href="#error" class="headerlink" title="error"></a>error</h3><ul><li>error 1</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">java.lang.NoClassDefFoundError: org/apache/tez/dag/api/TezConfiguration</span><br><span class="line">at org.apache.hadoop.hive.ql.exec.tez.TezSessionPoolSession$AbstractTriggerValidator.startTriggerValidator(TezSessionPoolSession.java:74) ~[hive-exec-3.1.2.jar:3.1.2]</span><br><span class="line">at org.apache.hadoop.hive.ql.exec.tez.TezSessionPoolManager.initTriggers(TezSessionPoolManager.java:207) ~[hive-exec-3.1.2.jar:3.1.2]</span><br><span class="line">at org.apache.hadoop.hive.ql.exec.tez.TezSessionPoolManager.startPool(TezSessionPoolManager.java:114) ~[hive-exec-3.1.2.jar:3.1.2]</span><br><span class="line">at org.apache.hive.service.server.HiveServer2.initAndStartTezSessionPoolManager(HiveServer2.java:839) ~[hive-service-3.1.2.jar:3.1.2]</span><br><span class="line">at org.apache.hive.service.server.HiveServer2.startOrReconnectTezSessions(HiveServer2.java:822) ~[hive-service-3.1.2.jar:3.1.2]</span><br><span class="line">at org.apache.hive.service.server.HiveServer2.start(HiveServer2.java:745) ~[hive-service-3.1.2.jar:3.1.2]</span><br><span class="line">at org.apache.hive.service.server.HiveServer2.startHiveServer2(HiveServer2.java:1037) [hive-service-3.1.2.jar:3.1.2]</span><br><span class="line">at org.apache.hive.service.server.HiveServer2.access$1600(HiveServer2.java:140) [hive-service-3.1.2.jar:3.1.2]</span><br><span class="line">at org.apache.hive.service.server.HiveServer2$StartOptionExecutor.execute(HiveServer2.java:1305) [hive-service-3.1.2.jar:3.1.2]</span><br><span class="line">at org.apache.hive.service.server.HiveServer2.main(HiveServer2.java:1149) [hive-service-3.1.2.jar:3.1.2]</span><br><span class="line">at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:1.8.0_222]</span><br><span class="line">at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[?:1.8.0_222]</span><br><span class="line">at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:1.8.0_222]</span><br><span class="line">at java.lang.reflect.Method.invoke(Method.java:498) ~[?:1.8.0_222]</span><br><span class="line">at org.apache.hadoop.util.RunJar.run(RunJar.java:239) [hadoop-common-2.8.5.jar:?]</span><br><span class="line">at org.apache.hadoop.util.RunJar.main(RunJar.java:153) [hadoop-common-2.8.5.jar:?]</span><br><span class="line">Caused by: java.lang.ClassNotFoundException: org.apache.tez.dag.api.TezConfiguration</span><br><span class="line">at java.net.URLClassLoader.findClass(URLClassLoader.java:382) ~[?:1.8.0_222]</span><br><span class="line">at java.lang.ClassLoader.loadClass(ClassLoader.java:424) ~[?:1.8.0_222]</span><br><span class="line">at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:349) ~[?:1.8.0_222]</span><br><span class="line">at java.lang.ClassLoader.loadClass(ClassLoader.java:357) ~[?:1.8.0_222]</span><br><span class="line">... 16 more</span><br></pre></td></tr></table></figure><blockquote><p>fix error<br>在hive-site.xml添加如下配置<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.server2.active.passive.ha.enable<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure></p></blockquote><h2 id="spark"><a href="#spark" class="headerlink" title="spark"></a>spark</h2><h3 id="检查是否安装成功"><a href="#检查是否安装成功" class="headerlink" title="检查是否安装成功"></a>检查是否安装成功</h3><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./bin/spark-submit --master spark://localhost:7077 --class org.apache.spark.examples.SparkPi ../examples/jars/spark-examples_2.11-2.1.1.jar 100</span><br><span class="line">./bin/spark-submit --master spark://localhost:7077 --class org.apache.spark.examples.SparkPi /home/chen/work/service/spark-2.3.0-bin-hadoop2.7/examples/jars/spark-examples_2.11-2.1.1.jar 100</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;big-data-environment&quot;&gt;&lt;a href=&quot;#big-data-environment&quot; class=&quot;headerlink&quot; title=&quot;big-data environment&quot;&gt;&lt;/a&gt;big-data environment&lt;/h2&gt;&lt;
      
    
    </summary>
    
    
      <category term="big-data" scheme="https://chenadminchen.github.io/tags/big-data/"/>
    
  </entry>
  
  <entry>
    <title>kotlin(java)-decode-xml</title>
    <link href="https://chenadminchen.github.io/2019/10/28/java-decode-xml/"/>
    <id>https://chenadminchen.github.io/2019/10/28/java-decode-xml/</id>
    <published>2019-10-28T06:02:34.000Z</published>
    <updated>2019-11-07T11:47:47.461Z</updated>
    
    <content type="html"><![CDATA[<h2 id="xml格式的数据转换成对象形式"><a href="#xml格式的数据转换成对象形式" class="headerlink" title="xml格式的数据转换成对象形式"></a>xml格式的数据转换成对象形式</h2><h3 id="1-xml解析使用的依赖包"><a href="#1-xml解析使用的依赖包" class="headerlink" title="1. xml解析使用的依赖包"></a>1. xml解析使用的依赖包</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">implementation(<span class="string">"org.jetbrains.kotlin:kotlin-reflect"</span>)</span><br><span class="line">implementation(<span class="string">"org.jetbrains.kotlin:kotlin-stdlib-jdk8"</span>)</span><br><span class="line"></span><br><span class="line">implementation(<span class="string">"com.fasterxml.jackson.dataformat:jackson-dataformat-xml:2.10.0.pr1"</span>)</span><br><span class="line">implementation(<span class="string">"com.fasterxml.jackson.core:jackson-core:2.10.0.pr1"</span>)</span><br><span class="line">implementation(<span class="string">"com.fasterxml.jackson.module:jackson-module-kotlin:2.10.0.pr1"</span>)</span><br></pre></td></tr></table></figure><h3 id="2-解析代码如下"><a href="#2-解析代码如下" class="headerlink" title="2. 解析代码如下"></a>2. 解析代码如下</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.dataformat.xml.XmlMapper</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.module.kotlin.registerKotlinModule</span><br><span class="line"></span><br><span class="line">   <span class="keyword">val</span> xml = <span class="string">"""&lt;xml&gt;</span></span><br><span class="line"><span class="string">   &lt;appid&gt;&lt;![CDATA[wx2421b1c4370ec43b]]&gt;&lt;/appid&gt;</span></span><br><span class="line"><span class="string">   &lt;mch_id&gt;&lt;![CDATA[10000100]]&gt;&lt;/mch_id&gt;</span></span><br><span class="line"><span class="string">   &lt;nonce_str&gt;&lt;![CDATA[TeqClE3i0mvn3DrK]]&gt;&lt;/nonce_str&gt;</span></span><br><span class="line"><span class="string">   &lt;out_refund_no_0&gt;&lt;![CDATA[1415701182]]&gt;&lt;/out_refund_no_0&gt;</span></span><br><span class="line"><span class="string">   &lt;out_trade_no&gt;&lt;![CDATA[1415757673]]&gt;&lt;/out_trade_no&gt;</span></span><br><span class="line"><span class="string">   &lt;refund_count&gt;1&lt;/refund_count&gt;</span></span><br><span class="line"><span class="string">   &lt;refund_fee_0&gt;1&lt;/refund_fee_0&gt;</span></span><br><span class="line"><span class="string">   &lt;refund_id_0&gt;&lt;![CDATA[2008450740201411110000174436]]&gt;&lt;/refund_id_0&gt;</span></span><br><span class="line"><span class="string">   &lt;refund_status_0&gt;&lt;![CDATA[PROCESSING]]&gt;&lt;/refund_status_0&gt;</span></span><br><span class="line"><span class="string">   &lt;refund_fee_1&gt;1&lt;/refund_fee_1&gt;</span></span><br><span class="line"><span class="string">   &lt;refund_id_1&gt;&lt;![CDATA[2008450740201411110000174436]]&gt;&lt;/refund_id_1&gt;</span></span><br><span class="line"><span class="string">   &lt;refund_status_1&gt;&lt;![CDATA[PROCESSING]]&gt;&lt;/refund_status_1&gt;</span></span><br><span class="line"><span class="string">   &lt;result_code&gt;&lt;![CDATA[SUCCESS]]&gt;&lt;/result_code&gt;</span></span><br><span class="line"><span class="string">   &lt;return_code&gt;&lt;![CDATA[SUCCESS]]&gt;&lt;/return_code&gt;</span></span><br><span class="line"><span class="string">   &lt;return_msg&gt;&lt;![CDATA[OK]]&gt;&lt;/return_msg&gt;</span></span><br><span class="line"><span class="string">   &lt;sign&gt;&lt;![CDATA[1F2841558E233C33ABA71A961D27561C]]&gt;&lt;/sign&gt;</span></span><br><span class="line"><span class="string">   &lt;transaction_id&gt;&lt;![CDATA[1008450740201411110005820873]]&gt;&lt;/transaction_id&gt;</span></span><br><span class="line"><span class="string">   &lt;coupon_type_0_0&gt;&lt;![CDATA[1008450740201411110005820873]]&gt;&lt;/coupon_type_0_0&gt;</span></span><br><span class="line"><span class="string">   &lt;single_coupon_refund_fee_0_0&gt;&lt;![CDATA[1008450740201411110005820873]]&gt;&lt;/single_coupon_refund_fee_0_0&gt;</span></span><br><span class="line"><span class="string">   &lt;coupon_type_0_1&gt;&lt;![CDATA[1008450740201411110005820873000____]]&gt;&lt;/coupon_type_0_1&gt;</span></span><br><span class="line"><span class="string">   &lt;single_coupon_refund_fee_0_1&gt;&lt;![CDATA[1008450740201411110005820873]]&gt;&lt;/single_coupon_refund_fee_0_1&gt;</span></span><br><span class="line"><span class="string">   &lt;coupon_type_1_1&gt;&lt;![CDATA[1008450740201411110005820873]]&gt;&lt;/coupon_type_1_1&gt;</span></span><br><span class="line"><span class="string">   &lt;single_coupon_refund_fee_1_1&gt;&lt;![CDATA[1008450740201411110005820873]]&gt;&lt;/single_coupon_refund_fee_1_1&gt;</span></span><br><span class="line"><span class="string">&lt;/xml&gt;"""</span></span><br><span class="line"><span class="comment">// XmlMapper().registerKotlinModule() 需要注入（否则@JsonAlias不生效）</span></span><br><span class="line"><span class="keyword">val</span> xmlMapper = XmlMapper().registerKotlinModule()</span><br><span class="line"><span class="keyword">val</span> xmlMapper = XmlMapper()</span><br><span class="line"><span class="keyword">var</span> wxPayOrderQueryResult = xmlMapper.readValue(result, WxPayOrderResult::<span class="class"><span class="keyword">class</span>.<span class="title">java</span>)</span></span><br></pre></td></tr></table></figure><h3 id="3-实体类代码如下："><a href="#3-实体类代码如下：" class="headerlink" title="3. 实体类代码如下："></a>3. 实体类代码如下：</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@XmlRootElement(name = <span class="meta-string">"xml"</span>)</span></span><br><span class="line"><span class="meta">@JacksonXmlRootElement(localName = <span class="meta-string">"xml"</span>)</span></span><br><span class="line"><span class="comment">//@JsonSerialize(include = JsonSerialize.Inclusion.NON_NULL)</span></span><br><span class="line"><span class="meta">@JsonInclude(JsonInclude.Include.NON_NULL)</span></span><br><span class="line"><span class="meta">@JsonIgnoreProperties(ignoreUnknown = true)</span></span><br><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">WxPayOrderResult</span></span>(</span><br><span class="line">        <span class="meta">@JsonAlias(<span class="meta-string">"return_code"</span>)</span></span><br><span class="line">        <span class="keyword">var</span> returnCode: String? = <span class="literal">null</span>,</span><br><span class="line"></span><br><span class="line">        <span class="meta">@JsonProperty(access = JsonProperty.Access.WRITE_ONLY)</span></span><br><span class="line">        <span class="keyword">var</span> appid: String? = <span class="literal">null</span>,</span><br><span class="line">        <span class="meta">@JsonAlias(<span class="meta-string">"return_msg"</span>)</span></span><br><span class="line">        <span class="keyword">var</span> returnMsg: String? = <span class="literal">null</span>,</span><br><span class="line">        <span class="meta">@JsonProperty(access = JsonProperty.Access.WRITE_ONLY)</span></span><br><span class="line">        <span class="meta">@JsonAlias(<span class="meta-string">"mch_id"</span>)</span></span><br><span class="line">        <span class="keyword">var</span> mchId: String? = <span class="literal">null</span>,</span><br><span class="line">        <span class="meta">@JsonAlias(<span class="meta-string">"nonce_str"</span>)</span></span><br><span class="line">        <span class="keyword">var</span> nonce: String? = <span class="literal">null</span>,</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> sign: String? = <span class="literal">null</span>,</span><br><span class="line">        <span class="meta">@JsonAlias(<span class="meta-string">"result_code"</span>)</span></span><br><span class="line">        <span class="keyword">var</span> resultCode: String? = <span class="literal">null</span>,</span><br><span class="line">        <span class="meta">@JsonAlias(<span class="meta-string">"err_code"</span>)</span></span><br><span class="line">        <span class="keyword">var</span> errCode: String? = <span class="literal">null</span>,</span><br><span class="line">        <span class="meta">@JsonAlias(<span class="meta-string">"err_code_des"</span>)</span></span><br><span class="line">        <span class="keyword">var</span> errCodeDes: String? = <span class="literal">null</span>,</span><br><span class="line">        <span class="meta">@JsonAlias(<span class="meta-string">"device_info"</span>)</span></span><br><span class="line">        <span class="keyword">var</span> deviceInfo: String? = <span class="literal">null</span>,</span><br><span class="line">        <span class="keyword">var</span> openid: String? = <span class="literal">null</span>,</span><br><span class="line">        <span class="meta">@JsonAlias(<span class="meta-string">"trade_type"</span>)</span></span><br><span class="line">        <span class="keyword">var</span> tradeType: String? = <span class="literal">null</span>,</span><br><span class="line">        <span class="meta">@JsonAlias(<span class="meta-string">"trade_state"</span>)</span></span><br><span class="line">        <span class="keyword">var</span> tradeState: String? = <span class="literal">null</span>,</span><br><span class="line">        <span class="meta">@JsonAlias(<span class="meta-string">"bank_type"</span>)</span></span><br><span class="line">        <span class="keyword">var</span> bankType: String? = <span class="literal">null</span>,</span><br><span class="line">        <span class="meta">@JsonAlias(<span class="meta-string">"total_fee"</span>)</span></span><br><span class="line">        <span class="keyword">var</span> totalFee: String? = <span class="literal">null</span>,</span><br><span class="line">        <span class="meta">@JsonAlias(<span class="meta-string">"fee_type"</span>)</span></span><br><span class="line">        <span class="keyword">var</span> feeType: String? = <span class="literal">null</span>,</span><br><span class="line">        <span class="meta">@JsonAlias(<span class="meta-string">"cash_fee"</span>)</span></span><br><span class="line">        <span class="keyword">var</span> cashFee: String? = <span class="literal">null</span>,</span><br><span class="line">        <span class="meta">@JsonAlias(<span class="meta-string">"cash_fee_type"</span>)</span>  <span class="comment">// `cash_fee_type`xml中属性名字</span></span><br><span class="line">        <span class="keyword">var</span> cashFeeType: String? = <span class="literal">null</span>,</span><br><span class="line">        <span class="meta">@JsonAlias(<span class="meta-string">"coupon_fee"</span>)</span></span><br><span class="line">        <span class="keyword">var</span> couponFee: String? = <span class="literal">null</span>,</span><br><span class="line">        <span class="meta">@JsonAlias(<span class="meta-string">"settlement_total_fee"</span>)</span></span><br><span class="line">        <span class="keyword">var</span> settlementTotalFee: String? = <span class="literal">null</span>,</span><br><span class="line">        <span class="meta">@JsonAlias(<span class="meta-string">"coupon_count"</span>)</span></span><br><span class="line">        <span class="keyword">var</span> couponCount: String? = <span class="literal">null</span>,</span><br><span class="line">        <span class="meta">@JsonAlias(<span class="meta-string">"transaction_id"</span>)</span></span><br><span class="line">        <span class="keyword">var</span> transactionId: String? = <span class="literal">null</span>,</span><br><span class="line">        <span class="meta">@JsonAlias(<span class="meta-string">"out_trade_no"</span>)</span></span><br><span class="line">        <span class="keyword">var</span> outTradeNo: String? = <span class="literal">null</span>,</span><br><span class="line">        <span class="keyword">var</span> attach: String? = <span class="literal">null</span>,</span><br><span class="line">        <span class="meta">@JsonAlias(<span class="meta-string">"time_end"</span>)</span></span><br><span class="line">        <span class="keyword">var</span> timeEnd: String? = <span class="literal">null</span>,</span><br><span class="line">        <span class="meta">@JsonAlias(<span class="meta-string">"trade_state_desc"</span>)</span></span><br><span class="line">        <span class="keyword">var</span> tradeStateDesc: String? = <span class="literal">null</span>,</span><br><span class="line">        <span class="meta">@JsonAlias(<span class="meta-string">"prepay_id"</span>)</span></span><br><span class="line">        <span class="keyword">var</span> prepayId: String? = <span class="literal">null</span></span><br><span class="line">) &#123;</span><br><span class="line">    <span class="meta">@JsonProperty(<span class="meta-string">"is_subscribe"</span>)</span></span><br><span class="line">    <span class="keyword">var</span> subscribe: String? = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;xml格式的数据转换成对象形式&quot;&gt;&lt;a href=&quot;#xml格式的数据转换成对象形式&quot; class=&quot;headerlink&quot; title=&quot;xml格式的数据转换成对象形式&quot;&gt;&lt;/a&gt;xml格式的数据转换成对象形式&lt;/h2&gt;&lt;h3 id=&quot;1-xml解析使用的依赖包
      
    
    </summary>
    
      <category term="java" scheme="https://chenadminchen.github.io/categories/java/"/>
    
    
      <category term="kotlin" scheme="https://chenadminchen.github.io/tags/kotlin/"/>
    
      <category term="xml" scheme="https://chenadminchen.github.io/tags/xml/"/>
    
  </entry>
  
  <entry>
    <title>spring-boot-feign</title>
    <link href="https://chenadminchen.github.io/2019/10/28/spring-boot-feign/"/>
    <id>https://chenadminchen.github.io/2019/10/28/spring-boot-feign/</id>
    <published>2019-10-28T06:02:34.000Z</published>
    <updated>2019-11-07T11:47:47.461Z</updated>
    
    <content type="html"><![CDATA[<h2 id="spring-boot-feign-ssl认证身份"><a href="#spring-boot-feign-ssl认证身份" class="headerlink" title="spring-boot-feign ssl认证身份"></a>spring-boot-feign ssl认证身份</h2><h3 id="1-feign使用的依赖包"><a href="#1-feign使用的依赖包" class="headerlink" title="1. feign使用的依赖包"></a>1. feign使用的依赖包</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">implementation(<span class="string">"org.springframework.cloud:spring-cloud-starter-openfeign"</span>)</span><br><span class="line">testImplementation(<span class="string">"org.springframework.boot:spring-boot-starter-test"</span>)</span><br></pre></td></tr></table></figure><h3 id="2-代码如下"><a href="#2-代码如下" class="headerlink" title="2. 代码如下"></a>2. 代码如下</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">wx-pay:</span></span><br><span class="line"><span class="attr">  mch_id:</span> <span class="number">1</span><span class="string">r5gfs90rtr61trw</span></span><br><span class="line"><span class="attr">  jks:</span> <span class="string">/home/work/file/apiclient_cert.p12</span></span><br><span class="line"><span class="attr">  server_alias:</span> <span class="string">tenpay</span> <span class="string">certificate</span></span><br></pre></td></tr></table></figure><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> feign.Client</span><br><span class="line"><span class="keyword">import</span> feign.Feign</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.<span class="keyword">annotation</span>.Autowired</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.<span class="keyword">annotation</span>.Bean</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.<span class="keyword">annotation</span>.Configuration</span><br><span class="line"><span class="keyword">import</span> javax.net.ssl.SSLSocketFactory</span><br><span class="line"></span><br><span class="line"><span class="comment">// defined feign server</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CustomFeignConfiguration</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">feignBuilder</span><span class="params">(sSLSocketFactory: <span class="type">SSLSocketFactory</span>)</span></span>: Feign.Builder &#123;</span><br><span class="line">        <span class="keyword">val</span> trustSSLSockets = Client.Default(sSLSocketFactory, <span class="literal">null</span>)</span><br><span class="line">        <span class="keyword">return</span> Feign.builder().client(trustSSLSockets)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>//feign use ssl jks<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.<span class="keyword">annotation</span>.Value</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component</span><br><span class="line"><span class="keyword">import</span> java.io.IOException</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream</span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress</span><br><span class="line"><span class="keyword">import</span> java.net.Socket</span><br><span class="line"><span class="keyword">import</span> java.security.KeyStore</span><br><span class="line"><span class="keyword">import</span> java.security.Principal</span><br><span class="line"><span class="keyword">import</span> java.security.PrivateKey</span><br><span class="line"><span class="keyword">import</span> java.security.SecureRandom</span><br><span class="line"><span class="keyword">import</span> java.security.cert.X509Certificate</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays</span><br><span class="line"><span class="keyword">import</span> javax.net.ssl.*</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    <span class="doctag">@mch</span>_id: ssl password</span></span><br><span class="line"><span class="comment">    <span class="doctag">@jks</span>: jks file</span></span><br><span class="line"><span class="comment">    <span class="doctag">@serverAlias</span>: jks alias</span></span><br><span class="line"><span class="comment">*/</span> </span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TrustingSSLSocketFactory</span> <span class="keyword">constructor</span></span>(<span class="meta">@Value(<span class="meta-string">"\$&#123;wx-pay.mch_id&#125;"</span>)</span>  <span class="keyword">val</span> mch_id: String, <span class="meta">@Value(<span class="meta-string">"\$&#123;wx-pay.jks&#125;"</span>)</span>  <span class="keyword">val</span> jks: String, <span class="meta">@Value(<span class="meta-string">"\$&#123;wx-pay.server_alias&#125;"</span>)</span>  <span class="keyword">val</span> serverAlias: String) : SSLSocketFactory(), X509TrustManager, X509KeyManager &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> delegate: SSLSocketFactory</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> privateKey: PrivateKey?</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> certificateChain: Array&lt;X509Certificate&gt;?</span><br><span class="line"></span><br><span class="line">    init &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">val</span> sc = SSLContext.getInstance(<span class="string">"SSL"</span>)</span><br><span class="line">            sc.init(arrayOf&lt;KeyManager&gt;(<span class="keyword">this</span>), arrayOf&lt;TrustManager&gt;(<span class="keyword">this</span>), SecureRandom())</span><br><span class="line">            <span class="keyword">this</span>.delegate = sc.socketFactory</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e: Exception) &#123;</span><br><span class="line">            <span class="keyword">throw</span> RuntimeException(e)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (serverAlias.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">this</span>.privateKey = <span class="literal">null</span></span><br><span class="line">            <span class="keyword">this</span>.certificateChain = <span class="literal">null</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">val</span> fileInputStream = FileInputStream(jks)</span><br><span class="line"></span><br><span class="line"><span class="comment">//                val keyStore = loadKeyStore(TrustingSSLSocketFactory::class.java.getResourceAsStream(jks), mch_id)</span></span><br><span class="line">                <span class="keyword">val</span> keyStore = loadKeyStore(fileInputStream, mch_id)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">this</span>.privateKey = keyStore.getKey(serverAlias, mch_id.toCharArray()) <span class="keyword">as</span> PrivateKey</span><br><span class="line"></span><br><span class="line">                <span class="keyword">val</span> rawChain = keyStore.getCertificateChain(serverAlias)</span><br><span class="line">                <span class="keyword">this</span>.certificateChain = Arrays.copyOf(rawChain, rawChain.size, Array&lt;X509Certificate&gt;::<span class="class"><span class="keyword">class</span>.<span class="title">java</span>)</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (e: Exception) &#123;</span><br><span class="line">                <span class="keyword">throw</span> RuntimeException(e)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">companion</span> <span class="keyword">object</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">val</span> ENABLED_CIPHER_SUITES = arrayOf(<span class="string">"TLS_RSA_WITH_AES_256_CBC_SHA"</span>)</span><br><span class="line"><span class="comment">//        //        private val sslSocketFactories = LinkedHashMap&lt;String, SSLSocketFactory&gt;()</span></span><br><span class="line"><span class="comment">//        private val KEYSTORE_PASSWORD = "1549064361".toCharArray()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        fun get(): SSLSocketFactory &#123;</span></span><br><span class="line"><span class="comment">//            return get("", "")</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//        @Synchronized</span></span><br><span class="line"><span class="comment">//        operator fun get(serverAlias: String, cert: String): SSLSocketFactory &#123;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//            if (!sslSocketFactories.containsKey(serverAlias)) &#123;</span></span><br><span class="line"><span class="comment">//                sslSocketFactories[serverAlias] = TrustingSSLSocketFactory(serverAlias)</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//            return sslSocketFactories[serverAlias]!!</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">        <span class="keyword">internal</span> <span class="function"><span class="keyword">fun</span> <span class="title">setEnabledCipherSuites</span><span class="params">(socket: <span class="type">Socket</span>)</span></span>: Socket &#123;</span><br><span class="line">            SSLSocket::<span class="class"><span class="keyword">class</span>.<span class="title">java</span>.<span class="title">cast</span></span>(socket).enabledCipherSuites = ENABLED_CIPHER_SUITES</span><br><span class="line">            <span class="keyword">return</span> socket</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Throws(IOException::class)</span></span><br><span class="line">        <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">loadKeyStore</span><span class="params">(inputStream: <span class="type">InputStream</span>, password: <span class="type">String</span>)</span></span>: KeyStore &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">val</span> keyStore = KeyStore.getInstance(<span class="string">"PKCS12"</span>)</span><br><span class="line">                keyStore.load(inputStream, password.toCharArray())</span><br><span class="line">                <span class="keyword">return</span> keyStore</span><br><span class="line">            &#125; <span class="keyword">catch</span> (e: Exception) &#123;</span><br><span class="line">                <span class="keyword">throw</span> RuntimeException(e)</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                inputStream.close()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getDefaultCipherSuites</span><span class="params">()</span></span>: Array&lt;String&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> ENABLED_CIPHER_SUITES</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getSupportedCipherSuites</span><span class="params">()</span></span>: Array&lt;String&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> ENABLED_CIPHER_SUITES</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Throws(IOException::class)</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">createSocket</span><span class="params">(s: <span class="type">Socket</span>, host: <span class="type">String</span>, port: <span class="type">Int</span>, autoClose: <span class="type">Boolean</span>)</span></span>: Socket &#123;</span><br><span class="line">        <span class="keyword">return</span> setEnabledCipherSuites(delegate.createSocket(s, host, port, autoClose))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Throws(IOException::class)</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">createSocket</span><span class="params">(host: <span class="type">String</span>, port: <span class="type">Int</span>)</span></span>: Socket &#123;</span><br><span class="line">        <span class="keyword">return</span> setEnabledCipherSuites(delegate.createSocket(host, port))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Throws(IOException::class)</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">createSocket</span><span class="params">(host: <span class="type">InetAddress</span>, port: <span class="type">Int</span>)</span></span>: Socket &#123;</span><br><span class="line">        <span class="keyword">return</span> setEnabledCipherSuites(delegate.createSocket(host, port))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Throws(IOException::class)</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">createSocket</span><span class="params">(host: <span class="type">String</span>, port: <span class="type">Int</span>, localHost: <span class="type">InetAddress</span>, localPort: <span class="type">Int</span>)</span></span>: Socket &#123;</span><br><span class="line">        <span class="keyword">return</span> setEnabledCipherSuites(delegate.createSocket(host, port, localHost, localPort))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Throws(IOException::class)</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">createSocket</span><span class="params">(address: <span class="type">InetAddress</span>, port: <span class="type">Int</span>, localAddress: <span class="type">InetAddress</span>, localPort: <span class="type">Int</span>)</span></span>: Socket &#123;</span><br><span class="line">        <span class="keyword">return</span> setEnabledCipherSuites(delegate.createSocket(address, port, localAddress, localPort))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getAcceptedIssuers</span><span class="params">()</span></span>: Array&lt;X509Certificate&gt;? &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">checkClientTrusted</span><span class="params">(certs: <span class="type">Array</span>&lt;<span class="type">X509Certificate</span>&gt;, authType: <span class="type">String</span>)</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">checkServerTrusted</span><span class="params">(certs: <span class="type">Array</span>&lt;<span class="type">X509Certificate</span>&gt;, authType: <span class="type">String</span>)</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getClientAliases</span><span class="params">(keyType: <span class="type">String</span>, issuers: <span class="type">Array</span>&lt;<span class="type">Principal</span>&gt;)</span></span>: Array&lt;String&gt;? &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">chooseClientAlias</span><span class="params">(keyType: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;, issuers: <span class="type">Array</span>&lt;<span class="type">Principal</span>&gt;, socket: <span class="type">Socket</span>)</span></span>: String? &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"null"</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getServerAliases</span><span class="params">(keyType: <span class="type">String</span>, issuers: <span class="type">Array</span>&lt;<span class="type">Principal</span>&gt;)</span></span>: Array&lt;String&gt;? &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">chooseServerAlias</span><span class="params">(keyType: <span class="type">String</span>, issuers: <span class="type">Array</span>&lt;<span class="type">Principal</span>&gt;, socket: <span class="type">Socket</span>)</span></span>: String &#123;</span><br><span class="line">        <span class="keyword">return</span> serverAlias</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getCertificateChain</span><span class="params">(alias: <span class="type">String</span>)</span></span>: Array&lt;X509Certificate&gt;? &#123;</span><br><span class="line">        <span class="keyword">return</span> certificateChain</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getPrivateKey</span><span class="params">(alias: <span class="type">String</span>)</span></span>: PrivateKey? &#123;</span><br><span class="line">        <span class="keyword">return</span> privateKey</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;spring-boot-feign-ssl认证身份&quot;&gt;&lt;a href=&quot;#spring-boot-feign-ssl认证身份&quot; class=&quot;headerlink&quot; title=&quot;spring-boot-feign ssl认证身份&quot;&gt;&lt;/a&gt;spring-boot
      
    
    </summary>
    
      <category term="spring-boot" scheme="https://chenadminchen.github.io/categories/spring-boot/"/>
    
    
      <category term="spring-boot" scheme="https://chenadminchen.github.io/tags/spring-boot/"/>
    
      <category term="feign" scheme="https://chenadminchen.github.io/tags/feign/"/>
    
  </entry>
  
  <entry>
    <title>mysql partition</title>
    <link href="https://chenadminchen.github.io/2019/10/25/mysql-partition/"/>
    <id>https://chenadminchen.github.io/2019/10/25/mysql-partition/</id>
    <published>2019-10-25T06:40:45.000Z</published>
    <updated>2019-11-07T11:47:47.461Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- create table</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`test_partition`</span> (</span><br><span class="line">  <span class="string">`name`</span> <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`time_test`</span> datetime <span class="keyword">NOT</span> <span class="literal">NULL</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- to_days()</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">to_days</span>(<span class="string">"2019-10-10"</span>); <span class="comment">-- 737707： from 1970-01-01 to 2019-10-10 have 737707 day </span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">month</span>(<span class="string">"2019-10-10"</span>); <span class="comment">-- 10： from 2019-01-01 to 2019-10-10 have 10 months </span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">year</span>(<span class="string">"2019-10-10"</span>); <span class="comment">-- 2019</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- `partition` can range to_days() and year()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- alter table add partition</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> test_partition <span class="keyword">partition</span> <span class="keyword">by</span> <span class="keyword">range</span> (<span class="keyword">to_days</span>(time_test)) (</span><br><span class="line"><span class="keyword">partition</span> p20191001 <span class="keyword">values</span> <span class="keyword">less</span> <span class="keyword">than</span> (<span class="keyword">to_days</span>(<span class="string">"2019-10-01"</span>)), </span><br><span class="line"><span class="keyword">partition</span> p20191101 <span class="keyword">values</span> <span class="keyword">less</span> <span class="keyword">than</span> (<span class="keyword">to_days</span>(<span class="string">"2019-11-01"</span>)));</span><br><span class="line"></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> test_partition <span class="keyword">add</span> <span class="keyword">partition</span>(<span class="keyword">partition</span> p20191201 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (<span class="keyword">to_days</span>(<span class="string">"2019-12-01"</span>) ) );</span><br><span class="line"></span><br><span class="line"><span class="comment">-- alter table drop partition ,but this table must have one partition</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> test_partition <span class="keyword">DROP</span> <span class="keyword">PARTITION</span> p20191201;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- select table partition</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">  partition_name part,</span><br><span class="line">  partition_expression expr,</span><br><span class="line">  partition_description <span class="keyword">descr</span>,</span><br><span class="line">  <span class="keyword">FROM_DAYS</span>(partition_description) lessthan_sendtime,</span><br><span class="line">  table_rows</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  INFORMATION_SCHEMA.partitions</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">  TABLE_SCHEMA = <span class="keyword">SCHEMA</span>() <span class="keyword">AND</span> TABLE_NAME=<span class="string">'test_partition'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 事务</span></span><br><span class="line">DELIMITER $$</span><br><span class="line"></span><br><span class="line"><span class="keyword">USE</span> <span class="string">`test`</span>$$</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`create_partition`</span>$$</span><br><span class="line"><span class="comment">/*这里复制的时候注意自己的登录用户*/</span></span><br><span class="line"><span class="keyword">CREATE</span> DEFINER=<span class="string">`root`</span>@<span class="string">`localhost`</span> <span class="keyword">PROCEDURE</span> <span class="string">`create_partition_test`</span>(<span class="keyword">IN</span> tableName <span class="built_in">VARCHAR</span>(<span class="number">20</span>),<span class="keyword">IN</span> interval_ <span class="built_in">INT</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="comment">/* 事务回滚，其实放这里没什么作用，ALTER TABLE是隐式提交，回滚不了的 */</span></span><br><span class="line">    <span class="keyword">DECLARE</span> <span class="keyword">EXIT</span> <span class="keyword">HANDLER</span> <span class="keyword">FOR</span> SQLEXCEPTION <span class="keyword">ROLLBACK</span>;</span><br><span class="line">    <span class="keyword">START</span> <span class="keyword">TRANSACTION</span>;</span><br><span class="line">  </span><br><span class="line"> <span class="comment">/* 到系统表查出这个表的最大分区，得到最大分区的日期。在创建分区的时候，名称就以日期格式存放，方便后面维护 */</span></span><br><span class="line">    <span class="keyword">SELECT</span> <span class="keyword">REPLACE</span>(partition_name,<span class="string">'p'</span>,<span class="string">''</span>) <span class="keyword">INTO</span> @P12_Name <span class="keyword">FROM</span> INFORMATION_SCHEMA.PARTITIONS </span><br><span class="line">    <span class="keyword">WHERE</span> table_name=tableName <span class="keyword">ORDER</span> <span class="keyword">BY</span> partition_ordinal_position <span class="keyword">DESC</span> <span class="keyword">LIMIT</span> <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">SET</span> @Max_date= <span class="built_in">DATE</span>(<span class="keyword">DATE_ADD</span>(@P12_Name+<span class="number">0</span>, <span class="built_in">INTERVAL</span> interval_ <span class="keyword">DAY</span>))+<span class="number">0</span>;</span><br><span class="line"> <span class="comment">/* 修改表，在最大分区的后面增加一个分区，时间范围加 interval_ 天 */</span></span><br><span class="line">     <span class="keyword">SET</span> @s1=<span class="keyword">CONCAT</span>(<span class="string">'ALTER TABLE '</span> ,tableName ,<span class="string">' ADD PARTITION (PARTITION p'</span>,@Max_date,<span class="string">' VALUES LESS THAN (TO_DAYS ('''</span>,<span class="built_in">DATE</span>(@Max_date),<span class="string">''')))'</span>);</span><br><span class="line">    <span class="comment">/* 输出查看增加分区语句*/</span></span><br><span class="line">     <span class="keyword">SELECT</span> @s1;</span><br><span class="line">   <span class="keyword">PREPARE</span> stmt2 <span class="keyword">FROM</span> @s1;</span><br><span class="line">     <span class="keyword">EXECUTE</span> stmt2;</span><br><span class="line">    <span class="keyword">DEALLOCATE</span> <span class="keyword">PREPARE</span> stmt2;</span><br><span class="line"> <span class="comment">/* 提交 */</span></span><br><span class="line">     <span class="keyword">COMMIT</span> ;</span><br><span class="line">  <span class="keyword">END</span>$$</span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;figure class=&quot;highlight sql&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;
      
    
    </summary>
    
      <category term="mysql" scheme="https://chenadminchen.github.io/categories/mysql/"/>
    
    
      <category term="mysql" scheme="https://chenadminchen.github.io/tags/mysql/"/>
    
      <category term="partition" scheme="https://chenadminchen.github.io/tags/partition/"/>
    
  </entry>
  
  <entry>
    <title>spring-boot-eureka</title>
    <link href="https://chenadminchen.github.io/2019/10/16/spring-boot-eureka/"/>
    <id>https://chenadminchen.github.io/2019/10/16/spring-boot-eureka/</id>
    <published>2019-10-16T07:13:45.000Z</published>
    <updated>2019-11-07T11:47:47.461Z</updated>
    
    <content type="html"><![CDATA[<h2 id="spring-boot-eureka"><a href="#spring-boot-eureka" class="headerlink" title="spring-boot-eureka"></a>spring-boot-eureka</h2><h3 id="application-yml"><a href="#application-yml" class="headerlink" title="application.yml"></a>application.yml</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">8541</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">#ssl</span></span><br><span class="line"><span class="attr">  ssl:</span></span><br><span class="line"><span class="attr">    enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    key-store:</span> <span class="string">ff.jks</span></span><br><span class="line"><span class="attr">    key-alias:</span> <span class="string">alias</span></span><br><span class="line"><span class="attr">    key-store-password:</span> <span class="number">123</span></span><br><span class="line"><span class="attr">    key-password:</span> <span class="number">123</span></span><br><span class="line">    </span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line"><span class="comment">#  environment: product</span></span><br><span class="line"></span><br><span class="line"><span class="attr">  instance:</span></span><br><span class="line">    <span class="comment">#non-secure-port-enabled: false</span></span><br><span class="line"><span class="comment">#    secure-port-enabled: true</span></span><br><span class="line"><span class="comment">#    secure-port: 8541</span></span><br><span class="line"><span class="attr">    preferIpAddress:</span> <span class="literal">true</span> <span class="comment">#注册时使用IP地址而不是机器名</span></span><br><span class="line">    <span class="comment">#hostname: localhost</span></span><br><span class="line"><span class="comment">#    ip-address: 192.168.1.1</span></span><br><span class="line"><span class="comment">#    instance-id: 192.168.1.1</span></span><br><span class="line"></span><br><span class="line"><span class="attr">  client:</span></span><br><span class="line"><span class="attr">    registerWithEureka:</span> <span class="literal">false</span></span><br><span class="line"><span class="comment">#    fetchRegistry: true</span></span><br><span class="line"><span class="attr">    serviceUrl:</span></span><br><span class="line"><span class="attr">      defaultZone:</span> <span class="attr">http://localhost:$&#123;server.port&#125;/eureka/</span></span><br><span class="line">    </span><br><span class="line"><span class="attr">zuul:</span></span><br><span class="line"><span class="attr">  retryable:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  routes:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">    user:</span></span><br><span class="line"><span class="attr">      sensitiveHeaders:</span>  <span class="comment">#服务之间的调用将头部信息转发</span></span><br><span class="line"><span class="attr">      serviceId:</span> <span class="string">user</span></span><br><span class="line">      </span><br><span class="line"><span class="attr">    perm:</span></span><br><span class="line"><span class="attr">      sensitiveHeaders:</span></span><br><span class="line"><span class="attr">      serviceId:</span> <span class="string">permission</span></span><br><span class="line"></span><br><span class="line"><span class="attr">    portal:</span></span><br><span class="line"><span class="attr">      path:</span> <span class="string">/portal/**</span></span><br><span class="line"><span class="attr">      url:</span> <span class="attr">http://localhost:8181</span></span><br></pre></td></tr></table></figure><h3 id="spring-boot-admin"><a href="#spring-boot-admin" class="headerlink" title="spring-boot-admin"></a>spring-boot-admin</h3><h3 id="spring-boot-sleuth-and-spring-boot-zipkin-and-spring-boot-actuator"><a href="#spring-boot-sleuth-and-spring-boot-zipkin-and-spring-boot-actuator" class="headerlink" title="spring-boot-sleuth and spring-boot-zipkin and spring-boot-actuator"></a><code>spring-boot-sleuth</code> and <code>spring-boot-zipkin</code> and <code>spring-boot-actuator</code></h3><p>&nbsp;&nbsp;Zipkin is a distributed tracing system. It helps gather timing data needed to troubleshoot latency problems in service architectures. Features include both the collection and lookup of this data.</p><p><a href="https://howtodoinjava.com/spring-cloud/spring-cloud-zipkin-sleuth-tutorial/" target="_blank" rel="noopener">sleuth学习地址</a><br><a href="https://zipkin.io/pages/quickstart.html" title="zipkin" target="_blank" rel="noopener">zipkin学习地址</a></p><h4 id="添加依赖"><a href="#添加依赖" class="headerlink" title="添加依赖"></a>添加依赖</h4><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//actuator 监控和管理Spring Boot应用，比如健康检查、审计、统计和HTTP追踪 </span></span><br><span class="line"> implementation(<span class="string">"org.springframework.boot:spring-boot-starter-actuator"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//Spring-Cloud-Sleuth是Spring Cloud的组成部分之一，为SpringCloud应用实现了一种分布式追踪解决方案，其兼容了Zipkin, HTrace和log-based追踪</span></span><br><span class="line">implementation(<span class="string">"org.springframework.cloud:spring-cloud-starter-sleuth"</span>)</span><br><span class="line">implementation(<span class="string">"org.springframework.cloud:spring-cloud-starter-zipkin"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//基础的依赖</span></span><br><span class="line"> implementation(<span class="string">'org.springframework.boot:spring-boot-starter-web'</span>)</span><br></pre></td></tr></table></figure><h4 id="application-yml配置"><a href="#application-yml配置" class="headerlink" title="application.yml配置"></a>application.yml配置</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="attr">spring:</span>       </span><br><span class="line"><span class="comment"># 提供application.name 方便查看日志信息</span></span><br><span class="line"><span class="attr">  application:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">permission</span></span><br><span class="line"><span class="attr">  zipkin:</span></span><br><span class="line"><span class="attr">    base-url:</span> <span class="attr">http://localhost:9441</span></span><br><span class="line"><span class="comment">#采样率  </span></span><br><span class="line"><span class="attr">  sleuth:</span>  </span><br><span class="line">    <span class="string">sampler.precentage:</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># actuator 配置，配合sleuth使用</span></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line"><span class="attr">  endpoints:</span></span><br><span class="line"><span class="attr">    web:</span></span><br><span class="line"><span class="attr">      exposure:</span></span><br><span class="line"><span class="attr">        include:</span> <span class="string">'*'</span></span><br><span class="line"><span class="attr">  endpoint:</span></span><br><span class="line"><span class="attr">    health:</span></span><br><span class="line"><span class="attr">      show-details:</span> <span class="string">always</span></span><br></pre></td></tr></table></figure><h4 id="配置采样率"><a href="#配置采样率" class="headerlink" title="配置采样率"></a>配置采样率</h4><p>日志采集的越多，追踪越全面，但是消耗也越大；反之日志追踪不够多也就失去了意义。到底追踪多少日志才是平衡点？Spring Cloud Sleuth把这个问题交给了使用者，<br>通过配置spring.sleuth.sampler.percentage=0.1这个参数来决定了日志记录发送给采集器的概率，0-1交给使用者自己配置。开发阶段和运行初期，一般配置成1全量收集日志，到了上线后可以慢慢降低这一概率。<br>开发者还可以直接在代码中创建AlwaysSampler实例来指定100%输出日志，效果跟spring.sleuth.sampler.percentage=1是一样的。</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">alwaysSampler</span><span class="params">()</span></span>: Sampler &#123;</span><br><span class="line">        <span class="keyword">return</span> Sampler.ALWAYS_SAMPLE</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;spring-boot-eureka&quot;&gt;&lt;a href=&quot;#spring-boot-eureka&quot; class=&quot;headerlink&quot; title=&quot;spring-boot-eureka&quot;&gt;&lt;/a&gt;spring-boot-eureka&lt;/h2&gt;&lt;h3 id=&quot;a
      
    
    </summary>
    
      <category term="spring-boot" scheme="https://chenadminchen.github.io/categories/spring-boot/"/>
    
    
      <category term="spring-boot" scheme="https://chenadminchen.github.io/tags/spring-boot/"/>
    
      <category term="eureka" scheme="https://chenadminchen.github.io/tags/eureka/"/>
    
  </entry>
  
  <entry>
    <title>hadoop</title>
    <link href="https://chenadminchen.github.io/2019/10/10/hadoop-command-learn-1/"/>
    <id>https://chenadminchen.github.io/2019/10/10/hadoop-command-learn-1/</id>
    <published>2019-10-10T06:16:45.000Z</published>
    <updated>2019-11-07T11:47:47.461Z</updated>
    
    <content type="html"><![CDATA[<h2 id="hadoop-environment-setup"><a href="#hadoop-environment-setup" class="headerlink" title="hadoop environment setup"></a>hadoop environment setup</h2><h3 id="ssh-authorization"><a href="#ssh-authorization" class="headerlink" title="ssh authorization"></a>ssh authorization</h3><p>. set use key login linux command<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa </span><br><span class="line">cat ~/.ssh/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys </span><br><span class="line">chmod 0600 ~/.ssh/authorized_keys</span><br></pre></td></tr></table></figure></p><p>. check key login is true<br>    use <code>ssh localhost</code> can login linux that is not input password  </p><h3 id="config-JAVA-HOME"><a href="#config-JAVA-HOME" class="headerlink" title="config JAVA_HOME"></a>config JAVA_HOME</h3><p>you must config <code>JAVA_HOME</code> environment</p><blockquote><p>sudo nano ~/.bashrc<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64</span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>source ~/.bashrc</p></blockquote><blockquote><p>echo $JAVA_HOME<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/lib/jvm/java-8-openjdk-amd64</span><br></pre></td></tr></table></figure></p></blockquote><h3 id="hadoop-start"><a href="#hadoop-start" class="headerlink" title="hadoop start"></a>hadoop start</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">YangTianT4900c-00:~/work/service/hadoop-3.2.1$ ./sbin/start-yarn.sh</span><br><span class="line">YangTianT4900c-00:~/work/service/hadoop-3.2.1$ ./sbin/stop-yarn.sh</span><br></pre></td></tr></table></figure><h2 id="hadoop-command"><a href="#hadoop-command" class="headerlink" title="hadoop command"></a>hadoop command</h2><p>-put<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">YangTianT4900c-00:~/work/service/hadoop-3.2.1$ ./bin/hadoop fs -put LICENSE.txt input</span><br></pre></td></tr></table></figure></p><p>-ls<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">YangTianT4900c-00:~/work/service/hadoop-3.2.1$ ./bin/hadoop fs -ls hdfsData</span><br></pre></td></tr></table></figure></p><ul><li>wordcount</li></ul><p>. <code>wordcount</code> can count word numbers<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">YangTianT4900c-00:~/work/service/hadoop-3.2.1$ ./bin/hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-3.2.1.jar wordcount hdfsData/LICENSE.txt output</span><br></pre></td></tr></table></figure></p><p>. show result<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">YangTianT4900c-00:~/work/service/hadoop-3.2.1$ cat output/part-r-00000</span><br></pre></td></tr></table></figure></p><h2 id="yarn"><a href="#yarn" class="headerlink" title="yarn"></a>yarn</h2><h2 id="map"><a href="#map" class="headerlink" title="map"></a>map</h2><h2 id="mapReduce"><a href="#mapReduce" class="headerlink" title="mapReduce"></a>mapReduce</h2>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;hadoop-environment-setup&quot;&gt;&lt;a href=&quot;#hadoop-environment-setup&quot; class=&quot;headerlink&quot; title=&quot;hadoop environment setup&quot;&gt;&lt;/a&gt;hadoop environ
      
    
    </summary>
    
    
      <category term="install" scheme="https://chenadminchen.github.io/tags/install/"/>
    
      <category term="hadoop" scheme="https://chenadminchen.github.io/tags/hadoop/"/>
    
      <category term="map" scheme="https://chenadminchen.github.io/tags/map/"/>
    
      <category term="mapReduce" scheme="https://chenadminchen.github.io/tags/mapReduce/"/>
    
      <category term="yarn" scheme="https://chenadminchen.github.io/tags/yarn/"/>
    
  </entry>
  
  <entry>
    <title>markdown_preview_enhanced</title>
    <link href="https://chenadminchen.github.io/2019/08/28/markdown-preview-enhancad/"/>
    <id>https://chenadminchen.github.io/2019/08/28/markdown-preview-enhancad/</id>
    <published>2019-08-28T06:35:34.000Z</published>
    <updated>2019-11-07T11:47:47.461Z</updated>
    
    <content type="html"><![CDATA[<h2 id="flowchart"><a href="#flowchart" class="headerlink" title="flowchart"></a>flowchart</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">st=&gt;start: Improve your</span><br><span class="line">l10n process!</span><br><span class="line">end=&gt;end: Continue to have fun!</span><br><span class="line">op1=&gt;operation: Go to locize.com</span><br><span class="line">sub1=&gt;subroutine: Read the awesomeness</span><br><span class="line">cond1=&gt;condition: Interested to</span><br><span class="line">getting started?</span><br><span class="line">sub2=&gt;subroutine: Read about improving</span><br><span class="line">your localizatin workflow</span><br><span class="line">or another source</span><br><span class="line">io1=&gt;inputoutput: Register</span><br><span class="line">op2=&gt;operation: Login</span><br><span class="line">cond2=&gt;condition: valid password</span><br><span class="line">cond3=&gt;condition: reset password</span><br><span class="line">sub3=&gt;subroutine: Create a demo project</span><br><span class="line">sub4=&gt;subroutine: start your real project</span><br><span class="line">io2=&gt;inputoutput: Subscribe</span><br><span class="line">op3=&gt;operation: send email</span><br><span class="line"></span><br><span class="line">st-&gt;op1-&gt;sub1-&gt;cond1</span><br><span class="line">cond1(yes)-&gt;io1-&gt;op2-&gt;cond2</span><br><span class="line">cond1(no)-&gt;sub2(bottom)-&gt;op1</span><br><span class="line">cond2(yes)-&gt;sub3-&gt;sub4-&gt;io2-&gt;end</span><br><span class="line">cond2(no)-&gt;cond3</span><br><span class="line">cond3(yes,right)-&gt;op3-&gt;op2</span><br><span class="line">cond3(no)-&gt;op2</span><br><span class="line"></span><br><span class="line">st@&gt;op1(&#123;&quot;stroke&quot;:&quot;Red&quot;&#125;)@&gt;sub1(&#123;&quot;stroke&quot;:&quot;Red&quot;&#125;)@&gt;cond1(&#123;&quot;stroke&quot;:&quot;Red&quot;&#125;)@&gt;io1(&#123;&quot;stroke&quot;:&quot;Red&quot;&#125;)@&gt;op2(&#123;&quot;stroke&quot;:&quot;Red&quot;&#125;)@&gt;cond2(&#123;&quot;stroke&quot;:&quot;Red&quot;&#125;)@&gt;sub3(&#123;&quot;stroke&quot;:&quot;Red&quot;&#125;)@&gt;sub4(&#123;&quot;stroke&quot;:&quot;Red&quot;&#125;)@&gt;io2(&#123;&quot;stroke&quot;:&quot;Red&quot;&#125;)@&gt;end(&#123;&quot;stroke&quot;:&quot;Red&quot;,&quot;stroke-width&quot;:6,&quot;arrow-end&quot;:&quot;classic-wide-long&quot;&#125;)</span><br></pre></td></tr></table></figure><h2 id="sequence"><a href="#sequence" class="headerlink" title="sequence"></a>sequence</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Title: Here is a title</span><br><span class="line">A-&gt;B: Normal line</span><br><span class="line">B--&gt;C: Dashed line</span><br><span class="line">C-&gt;&gt;D: Open arrow</span><br><span class="line">D--&gt;&gt;A: Dashed open arrow</span><br></pre></td></tr></table></figure><h2 id="Mermaid"><a href="#Mermaid" class="headerlink" title="Mermaid"></a>Mermaid</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">  A --&gt; B;</span><br><span class="line">  B --&gt; C;</span><br><span class="line">  C --&gt; A;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;flowchart&quot;&gt;&lt;a href=&quot;#flowchart&quot; class=&quot;headerlink&quot; title=&quot;flowchart&quot;&gt;&lt;/a&gt;flowchart&lt;/h2&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;t
      
    
    </summary>
    
      <category term="markdown" scheme="https://chenadminchen.github.io/categories/markdown/"/>
    
    
      <category term="markdown_preview_enhanced" scheme="https://chenadminchen.github.io/tags/markdown-preview-enhanced/"/>
    
      <category term="visual-studio-code" scheme="https://chenadminchen.github.io/tags/visual-studio-code/"/>
    
  </entry>
  
  <entry>
    <title></title>
    <link href="https://chenadminchen.github.io/2019/08/27/spark-learn/"/>
    <id>https://chenadminchen.github.io/2019/08/27/spark-learn/</id>
    <published>2019-08-27T14:50:18.984Z</published>
    <updated>2019-08-27T14:50:18.984Z</updated>
    
    <content type="html"><![CDATA[<h1 id="spark-learn"><a href="#spark-learn" class="headerlink" title="spark learn"></a>spark learn</h1><h2 id="run-shell"><a href="#run-shell" class="headerlink" title="run shell"></a>run shell</h2><p><a href="http://spark.apache.org/docs/2.4.3/#running-the-examples-and-shell" target="_blank" rel="noopener">learn-address</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># pathon</span><br><span class="line">./bin/pyspark --master local[2]</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;spark-learn&quot;&gt;&lt;a href=&quot;#spark-learn&quot; class=&quot;headerlink&quot; title=&quot;spark learn&quot;&gt;&lt;/a&gt;spark learn&lt;/h1&gt;&lt;h2 id=&quot;run-shell&quot;&gt;&lt;a href=&quot;#run-shel
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>java-python-javaScript-iterator-iterable学习</title>
    <link href="https://chenadminchen.github.io/2019/07/06/java-python-javaScript-iterator-iterable/"/>
    <id>https://chenadminchen.github.io/2019/07/06/java-python-javaScript-iterator-iterable/</id>
    <published>2019-07-06T08:47:55.823Z</published>
    <updated>2019-07-06T08:47:55.823Z</updated>
    
    <content type="html"><![CDATA[<h2 id="java"><a href="#java" class="headerlink" title="java"></a>java</h2><h3 id="iterator"><a href="#iterator" class="headerlink" title="iterator"></a>iterator</h3><h3 id="iterable"><a href="#iterable" class="headerlink" title="iterable"></a>iterable</h3><h2 id="python"><a href="#python" class="headerlink" title="python"></a>python</h2><h3 id="iterable-可迭代的"><a href="#iterable-可迭代的" class="headerlink" title="iterable/可迭代的"></a>iterable/可迭代的</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;当对象中存在<em>iter</em>方法时，该对象就是iterable对象，若一般对象实现<em>iter</em>方法时，它将成为iterable，其在python中iterable的有以下：[列表、字典、元组]</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">l = [1,2,3]</span><br><span class="line">dir(l)            <span class="comment"># _iter_</span></span><br><span class="line">iter(l)           <span class="comment"># &lt;list_iterator at 0x69c8048&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">In [12]: iter(123)</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">TypeError                                 Traceback (most recent call last)</span><br><span class="line">&lt;ipython-input-12-7ce543a15833&gt; <span class="keyword">in</span> &lt;module&gt;()</span><br><span class="line">----&gt; 1 iter(123)</span><br><span class="line"></span><br><span class="line">TypeError: <span class="string">'int'</span> object is not iterable</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">In [21]: dict = &#123;<span class="string">'Alice'</span>: <span class="string">'2341'</span>, <span class="string">'Beth'</span>: <span class="string">'9102'</span>, <span class="string">'Cecil'</span>: <span class="string">'3258'</span>&#125;</span><br><span class="line"></span><br><span class="line">In [22]: iter(dict)</span><br><span class="line">Out[22]: &lt;dict_keyiterator at 0x59d81d8&gt;     <span class="comment">#返回一个键的可迭代对象</span></span><br><span class="line"></span><br><span class="line">In [25]: next(dict)                          <span class="comment">#字典不是一个迭代器，它只是一个迭代对象</span></span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">TypeError                                 Traceback (most recent call last)</span><br><span class="line">&lt;ipython-input-25-9c216d0aadb1&gt; <span class="keyword">in</span> &lt;module&gt;()</span><br><span class="line">----&gt; 1 next(dict)</span><br><span class="line"></span><br><span class="line">TypeError: <span class="string">'dict'</span> object is not an iterator</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">In [23]: l = [1,2,3]</span><br><span class="line"></span><br><span class="line">In [24]: iter(l)</span><br><span class="line">Out[24]: &lt;list_iterator at 0x69ea710&gt;       <span class="comment">#返回一个值本身的可迭代对象</span></span><br></pre></td></tr></table></figure><p>自定义迭代对象</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">In [42]: class String(object):</span><br><span class="line">    ...:</span><br><span class="line">    ...:     def __init__(self, val):</span><br><span class="line">    ...:</span><br><span class="line">    ...:         self.val = val</span><br><span class="line">    ...:</span><br><span class="line">    ...:     def __str__(self):</span><br><span class="line">    ...:</span><br><span class="line">    ...:         <span class="built_in">return</span> self.val</span><br><span class="line">    ...:</span><br><span class="line">    ...:     def __iter__(self):</span><br><span class="line">    ...:</span><br><span class="line">    ...:         <span class="built_in">print</span>(<span class="string">"This is __iter__ method of String class"</span>)</span><br><span class="line">    ...:</span><br><span class="line">    ...:         <span class="built_in">return</span> iter(self.val)  <span class="comment">#self.val is python string so iter() will return it's iterat</span></span><br><span class="line">    ...:</span><br><span class="line"></span><br><span class="line">In [43]: s = String(<span class="string">"test"</span>)</span><br><span class="line"></span><br><span class="line">In [44]: iter(s)</span><br><span class="line">This is __iter__ method of String class</span><br><span class="line">Out[44]: &lt;str_iterator at 0x56c1400&gt;</span><br></pre></td></tr></table></figure><h3 id="iterator-迭代器"><a href="#iterator-迭代器" class="headerlink" title="iterator/迭代器"></a>iterator/迭代器</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;当对象中存在<em>iter</em>方法,并且存在<em>next</em>()方法时，它将是一个iterator,迭代器可用for lopp 进行获取值，可以调用next()方法进行获取值。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;iterator对象存在一次性特点，当使用next()或<em>next</em>()获得值时，若对象不存在下一个值时，raise stopIteration 异常<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;iter()函数为一个可迭代对象返回一个迭代器,如果给iter函数传入一个迭代器，它就直接返回那个迭代器<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#迭代器 实现逻辑</span></span><br><span class="line">class Iterator:</span><br><span class="line"></span><br><span class="line">    def __init__(self, iterable)</span><br><span class="line"></span><br><span class="line">        self.iterable = iterable</span><br><span class="line"></span><br><span class="line">    def __iter__(self):  <span class="comment">#iter should return self if called on iterator</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">return</span> self</span><br><span class="line"></span><br><span class="line">    def next(self):  <span class="comment">#Use __next__() in python 3.x</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> condition: <span class="comment">#it should raise StopIteration exception if no next element is left to return</span></span><br><span class="line"></span><br><span class="line">            raise StopIteration</span><br></pre></td></tr></table></figure></p><h2 id="javaScript"><a href="#javaScript" class="headerlink" title="javaScript"></a>javaScript</h2><h3 id="iterator-1"><a href="#iterator-1" class="headerlink" title="iterator"></a>iterator</h3><figure class="highlight javascript"><figcaption><span>1.8</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">let</span> someString = <span class="string">"someString"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typeof</span> someString[<span class="built_in">Symbol</span>.iterator];</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> iterator = someString[<span class="built_in">Symbol</span>.iterator]();</span><br><span class="line"></span><br><span class="line">iterator + <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">iterator.next();</span><br></pre></td></tr></table></figure><h3 id="iterable-1"><a href="#iterable-1" class="headerlink" title="iterable"></a>iterable</h3><figure class="highlight javascript"><figcaption><span>1.8</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">let</span> user = &#123; <span class="string">"name"</span>: <span class="string">"test1"</span>, <span class="string">"age"</span>: <span class="number">3</span> &#125;;</span><br><span class="line"></span><br><span class="line">userIterable = &#123;</span><br><span class="line">    [<span class="built_in">Symbol</span>.iterator]() &#123;</span><br><span class="line">        <span class="keyword">let</span> keys = <span class="built_in">Object</span>.keys(user);</span><br><span class="line">        <span class="keyword">var</span> index = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            next() &#123;</span><br><span class="line">                <span class="keyword">if</span> (keys.length &gt; index) &#123;</span><br><span class="line">                    <span class="keyword">let</span> key = keys[index++];</span><br><span class="line">                    <span class="keyword">return</span> &#123; <span class="attr">value</span>: &#123;<span class="attr">key</span>: key, <span class="attr">value</span>: user[key]&#125;, <span class="attr">done</span>: <span class="literal">false</span> &#125;;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> &#123; <span class="attr">value</span>: <span class="literal">null</span>, <span class="attr">done</span>: <span class="literal">true</span> &#125;;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="keyword">return</span>(v) &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">"Done"</span>);</span><br><span class="line">                <span class="keyword">return</span> &#123; <span class="attr">value</span>: v, <span class="attr">done</span>: <span class="literal">true</span> &#125;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> s <span class="keyword">of</span> userIterable)&#123;</span><br><span class="line">    <span class="built_in">console</span>.info(s);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="generator"><a href="#generator" class="headerlink" title="generator"></a>generator</h3><figure class="highlight javascript"><figcaption><span>1.8</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//function* defined generator function</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">generator</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">4</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> ge = generator();</span><br><span class="line"><span class="built_in">console</span>.info(ge.next().value);</span><br><span class="line"></span><br><span class="line"><span class="comment">//check userIterable[Symbol.iterator] type</span></span><br><span class="line"><span class="keyword">typeof</span> userIterable[<span class="built_in">Symbol</span>.iterator]</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;java&quot;&gt;&lt;a href=&quot;#java&quot; class=&quot;headerlink&quot; title=&quot;java&quot;&gt;&lt;/a&gt;java&lt;/h2&gt;&lt;h3 id=&quot;iterator&quot;&gt;&lt;a href=&quot;#iterator&quot; class=&quot;headerlink&quot; title=&quot;i
      
    
    </summary>
    
      <category term="iterator" scheme="https://chenadminchen.github.io/categories/iterator/"/>
    
    
      <category term="javaScript" scheme="https://chenadminchen.github.io/tags/javaScript/"/>
    
      <category term="java" scheme="https://chenadminchen.github.io/tags/java/"/>
    
      <category term="python" scheme="https://chenadminchen.github.io/tags/python/"/>
    
      <category term="iterator" scheme="https://chenadminchen.github.io/tags/iterator/"/>
    
  </entry>
  
  <entry>
    <title>java-python-javaScript-iterator-iterable学习</title>
    <link href="https://chenadminchen.github.io/2019/07/06/java-python-javaScript-filter-map-reduce/"/>
    <id>https://chenadminchen.github.io/2019/07/06/java-python-javaScript-filter-map-reduce/</id>
    <published>2019-07-06T08:45:58.790Z</published>
    <updated>2019-07-06T08:45:58.790Z</updated>
    
    <content type="html"><![CDATA[<h2 id="java"><a href="#java" class="headerlink" title="java"></a>java</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;自java更新到jdk8后，添加了lambda表达式及java.util.Stream,以下便是对此进行说明<br>Stream对数据进行处理，但对原来的数据不进行更改</p><h3 id="java创建stream的几种方法"><a href="#java创建stream的几种方法" class="headerlink" title="java创建stream的几种方法"></a>java创建stream的几种方法</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;From a Collection via the stream() and parallelStream() methods</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;From an array via Arrays.stream(Object[])</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">int[] array = &#123;1, 2, 3, 4, 5&#125;</span><br><span class="line"></span><br><span class="line">Stream stream = Arrays.stream(array)</span><br></pre></td></tr></table></figure><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;From static factory methods on the stream classes, such as Stream.of(Object[]), IntStream.range(int, int) or Stream.iterate(Object, UnaryOperator)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">int[] array = &#123;1, 2, 3, 4, 5&#125;</span><br><span class="line"></span><br><span class="line">Stream stream = Stream.of(array)</span><br><span class="line"></span><br><span class="line">Stream stream = IntStream.range(3,9)      //stream = &#123;3, 4, 5, 6, 7, 8, 9&#125;</span><br></pre></td></tr></table></figure><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The lines of a file can be obtained from BufferedReader.lines()</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">BufferedReader bufferedReader = new BufferedReader(new FileReader(<span class="string">"E:\\tmdb_5000_movies2.json"</span>));</span><br><span class="line"></span><br><span class="line">Stream stream = bufferedReader.lines()</span><br></pre></td></tr></table></figure><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Streams of file paths can be obtained from methods in Files</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Streams of random numbers can be obtained from Random.ints()</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Random.ints().asLongStream()</span><br></pre></td></tr></table></figure><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Numerous other stream-bearing methods in the JDK, including BitSet.stream(), Pattern.splitAsStream(java.lang.CharSequence), and JarFile.stream()</p><h3 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;对stream的对象内的内容进行对其内部的所有数据进行循环，过滤不符合条件的数据，不会带来副作用</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">int[] array = &#123;1, 2, 3, 4, 5&#125;</span><br><span class="line"></span><br><span class="line">Stream stream = Stream.of(array)</span><br><span class="line"></span><br><span class="line">stream.filter(e -&gt; e / 2 == 0).forEach(System.out::println)  // --&gt; &#123;2, 4&#125;</span><br></pre></td></tr></table></figure><h3 id="map"><a href="#map" class="headerlink" title="map"></a>map</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;获得stream对象中的数据进行操作，对其内部的所有数据进行循环操作，若用它进行过滤，将会带来副作用，不仅能返回值，同时返回可过滤后的结果Boolean值</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">int[] array = &#123;1, 2, 3, 4, 5&#125;</span><br><span class="line"></span><br><span class="line">Stream stream = Stream.of(array)</span><br><span class="line"></span><br><span class="line">stream.filter(e -&gt; e / 2 == 0)</span><br><span class="line">.map(e -&gt; e*2)</span><br><span class="line">.forEach(System.out::println)  // --&gt; &#123;4, 8&#125;</span><br></pre></td></tr></table></figure><h3 id="reduce"><a href="#reduce" class="headerlink" title="reduce"></a>reduce</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;该函数处于stream终端，用了reduce函数后不可再用stream的其他方法，若需要使用stream的方法时需要重新stream化.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;在java8中reduce方法重载有三个，三个方法中的参数数量不同</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># supplier为reduce方法开始的参数，同时决定着返回值的类型</span></span><br><span class="line"><span class="comment"># 当stream为并行化时才会调用combiner</span></span><br><span class="line">stream.parallel().reduce(Supplier&lt;R&gt; supplier, BiConsumer&lt;R, ? super T&gt; accumulator, BiConsumer&lt;R, R&gt; combiner)</span><br><span class="line"></span><br><span class="line">stream.reduce(Supplier&lt;R&gt; supplier, BiConsumer&lt;R, ? super T&gt; accumulator, BiConsumer&lt;R, R&gt; combiner)</span><br><span class="line"></span><br><span class="line">stream.reduce(BiConsumer&lt;R, ? super T&gt; accumulator)</span><br></pre></td></tr></table></figure><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">stream.filter(e -&gt; e / 2 == 0)</span><br><span class="line">.map(e -&gt; e*2)</span><br><span class="line">.reduce()</span><br></pre></td></tr></table></figure><h2 id="javaScript"><a href="#javaScript" class="headerlink" title="javaScript"></a>javaScript</h2><h3 id="iterator"><a href="#iterator" class="headerlink" title="iterator"></a>iterator</h3><h3 id="iterable"><a href="#iterable" class="headerlink" title="iterable"></a>iterable</h3>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;java&quot;&gt;&lt;a href=&quot;#java&quot; class=&quot;headerlink&quot; title=&quot;java&quot;&gt;&lt;/a&gt;java&lt;/h2&gt;&lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;自java更新到jdk8后，
      
    
    </summary>
    
      <category term="filter" scheme="https://chenadminchen.github.io/categories/filter/"/>
    
    
      <category term="javaScript" scheme="https://chenadminchen.github.io/tags/javaScript/"/>
    
      <category term="map" scheme="https://chenadminchen.github.io/tags/map/"/>
    
      <category term="java" scheme="https://chenadminchen.github.io/tags/java/"/>
    
      <category term="python" scheme="https://chenadminchen.github.io/tags/python/"/>
    
      <category term="filter" scheme="https://chenadminchen.github.io/tags/filter/"/>
    
      <category term="reduce" scheme="https://chenadminchen.github.io/tags/reduce/"/>
    
  </entry>
  
  <entry>
    <title>mongodb 基本语法学习（一）</title>
    <link href="https://chenadminchen.github.io/2019/07/06/mongodb-learn-1/"/>
    <id>https://chenadminchen.github.io/2019/07/06/mongodb-learn-1/</id>
    <published>2019-07-06T08:45:58.790Z</published>
    <updated>2019-07-06T08:45:58.790Z</updated>
    
    <content type="html"><![CDATA[<h2 id="mongodb-基本语法操作"><a href="#mongodb-基本语法操作" class="headerlink" title="mongodb 基本语法操作"></a>mongodb 基本语法操作</h2><h3 id="mongodb的数据库切换操作"><a href="#mongodb的数据库切换操作" class="headerlink" title="mongodb的数据库切换操作"></a>mongodb的数据库切换操作</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">show dbs;   <span class="comment">#查看mongodb数据库中存在的数据库</span></span><br><span class="line">use datebase_name;   <span class="comment">#使用指定的数据库</span></span><br><span class="line">show collections;   <span class="comment">#查看某个数据库下所有的collction</span></span><br></pre></td></tr></table></figure><h3 id="对collection操作"><a href="#对collection操作" class="headerlink" title="对collection操作"></a>对collection操作</h3><h4 id="json的数据格式"><a href="#json的数据格式" class="headerlink" title="json的数据格式"></a>json的数据格式</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">consult: </span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"_id"</span>: 111,  </span><br><span class="line">    <span class="string">'user_id'</span>:<span class="string">'1234@163.com'</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">'public'</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">'time'</span>:<span class="string">'2017.11.01 12:25:33'</span></span><br><span class="line"></span><br><span class="line">    <span class="string">'number'</span>:1</span><br><span class="line">    <span class="string">'title'</span>:<span class="string">'如果长高'</span>,</span><br><span class="line">    <span class="string">'content'</span>:<span class="string">'怎么才能长高？？？？'</span>,</span><br><span class="line">    <span class="string">'resouces'</span>:[</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">'url'</span>:<span class="string">""</span></span><br><span class="line">            <span class="string">'type'</span>:<span class="string">""</span></span><br><span class="line">            <span class="string">'comment'</span>:<span class="string">""</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">    <span class="string">'reply'</span>:[</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">'content'</span>:<span class="string">'test1'</span></span><br><span class="line">            <span class="string">'time'</span>:<span class="string">""</span></span><br><span class="line">            <span class="string">'user_id'</span>: <span class="string">'123@yf.com'</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">'content'</span>:<span class="string">'test2'</span></span><br><span class="line">            <span class="string">'time'</span>:</span><br><span class="line">            <span class="string">'user_id'</span>: <span class="string">'222@yf.com'</span>     </span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="find-操作"><a href="#find-操作" class="headerlink" title="find()操作"></a>find()操作</h4><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;以下基于该json数据进行操作</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.consult.find().pretty();   <span class="comment">#查看consult下的数据并以json格式展示</span></span><br><span class="line">db.consult.find(&#123;<span class="string">'_id'</span>:111&#125;);   <span class="comment">#查找_id为111的数据</span></span><br><span class="line">db.consult.find(&#123;<span class="string">'_id'</span>:111,<span class="string">'reply.user_id'</span>:<span class="string">'222@yf.com'</span>&#125;);   <span class="comment">#查找 _id: 111,reply数据组中user_id ： '222@yf.com'的数据</span></span><br></pre></td></tr></table></figure><h4 id="remove-操作"><a href="#remove-操作" class="headerlink" title="remove()操作"></a>remove()操作</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.consult.remove()   <span class="comment">#删除consult内的数据</span></span><br></pre></td></tr></table></figure><h4 id="update-操作"><a href="#update-操作" class="headerlink" title="update()操作"></a>update()操作</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">db.consult.update(&#123;<span class="string">'_id'</span>:111&#125;,&#123;<span class="variable">$set</span>:&#123;<span class="string">'public'</span>:<span class="literal">false</span>&#125;&#125;);   <span class="comment">#修改 _id : 111中字段public的值</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#数组修改器push() 数组中存在则修改，若不存在则添加</span></span><br><span class="line">db.conuslt.update(&#123;<span class="string">'_id'</span>:111,<span class="string">'reply.user_id'</span>:<span class="string">'222@yf.com'</span>&#125;,&#123;<span class="variable">$push</span>:&#123;<span class="string">'reply.content'</span>:<span class="string">'测试'</span>&#125;&#125;);   <span class="comment">#修改 '_id':111中reply中数组中'reply.user_id':'222@yf.com'的content值</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#对json内的数值字段进行操作，$inc</span></span><br><span class="line">db.consult.update(&#123;<span class="string">'_id'</span>:111&#125;,&#123;<span class="variable">$inc</span>:&#123;<span class="string">'number'</span> : 1 &#125;&#125;);   <span class="comment">#将json内的number值加1</span></span><br><span class="line">db.consult.update(&#123;<span class="string">'_id'</span>:111&#125;,&#123;<span class="variable">$inc</span>:&#123;<span class="string">'number '</span>: -1 &#125;&#125;);   <span class="comment">#将json内的number值减1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#对json内普通字段进行操作，并能改变字段类型，$set</span></span><br><span class="line">db.consult.update(&#123;<span class="string">'_id'</span>:111&#125;,&#123;<span class="variable">$set</span>:&#123;<span class="string">'number'</span> : 3 &#125;&#125;);   <span class="comment">#修改number值</span></span><br><span class="line">db.consult.update(&#123;<span class="string">'_id'</span>:111&#125;,&#123;<span class="variable">$set</span>:&#123;<span class="string">'number'</span> : <span class="string">'test1'</span> &#125;&#125;);  <span class="comment">#将number字段类型数值型改为字符串型</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;mongodb-基本语法操作&quot;&gt;&lt;a href=&quot;#mongodb-基本语法操作&quot; class=&quot;headerlink&quot; title=&quot;mongodb 基本语法操作&quot;&gt;&lt;/a&gt;mongodb 基本语法操作&lt;/h2&gt;&lt;h3 id=&quot;mongodb的数据库切换操作&quot;&gt;
      
    
    </summary>
    
      <category term="mongodb" scheme="https://chenadminchen.github.io/categories/mongodb/"/>
    
    
      <category term="mongodb" scheme="https://chenadminchen.github.io/tags/mongodb/"/>
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="https://chenadminchen.github.io/2019/07/06/hello-world/"/>
    <id>https://chenadminchen.github.io/2019/07/06/hello-world/</id>
    <published>2019-07-06T08:45:58.774Z</published>
    <updated>2019-07-06T08:45:58.774Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>dart-object-copy</title>
    <link href="https://chenadminchen.github.io/2019/06/04/dart-object-copy/"/>
    <id>https://chenadminchen.github.io/2019/06/04/dart-object-copy/</id>
    <published>2019-06-04T07:36:45.000Z</published>
    <updated>2019-08-27T14:50:18.984Z</updated>
    
    <content type="html"><![CDATA[<h2 id="dart-object-copy"><a href="#dart-object-copy" class="headerlink" title="dart object copy"></a>dart object copy</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;现在创建一个普通的实体类，并且该类带有main方法，如下代码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">//copy class </span><br><span class="line">import <span class="string">'dart:math'</span>;</span><br><span class="line"></span><br><span class="line">void <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">  </span><br><span class="line">  Todo todo1= Todo(<span class="string">"todo1"</span>,10);</span><br><span class="line">    </span><br><span class="line">  Todo todo2 = Todo.copy(todo1);</span><br><span class="line">  </span><br><span class="line">  <span class="built_in">print</span>(<span class="string">"todo1 == todo2 : <span class="variable">$&#123;todo1 == todo2&#125;</span>"</span>);</span><br><span class="line">  </span><br><span class="line">  todo2.todo = <span class="string">"fffff"</span>;</span><br><span class="line">   </span><br><span class="line">  <span class="built_in">print</span>(<span class="string">"todo2 tom todo1.copy: <span class="variable">$&#123;todo1 == todo2&#125;</span>"</span>);</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Todo&#123;</span><br><span class="line">  String todo;</span><br><span class="line">  int priority;</span><br><span class="line">  int <span class="built_in">hash</span>;</span><br><span class="line">  </span><br><span class="line">  factory Todo.copy(Todo t)&#123;</span><br><span class="line">    <span class="built_in">return</span> new Todo(t.todo,t.priority,<span class="built_in">hash</span>:t.hash);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  Todo(this.todo,this.priority,&#123;this.hash&#125;);</span><br><span class="line">  </span><br><span class="line">  bool operator == (o)&#123;</span><br><span class="line">    <span class="built_in">return</span> o is Todo &amp;&amp; o.todo == todo &amp;&amp; o.priority == priority;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  int get hashCode =&gt; <span class="built_in">hash</span> *100 ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;dart-object-copy&quot;&gt;&lt;a href=&quot;#dart-object-copy&quot; class=&quot;headerlink&quot; title=&quot;dart object copy&quot;&gt;&lt;/a&gt;dart object copy&lt;/h2&gt;&lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;n
      
    
    </summary>
    
    
      <category term="dart" scheme="https://chenadminchen.github.io/tags/dart/"/>
    
      <category term="class" scheme="https://chenadminchen.github.io/tags/class/"/>
    
  </entry>
  
</feed>
